"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7806],{3905:(e,t,n)=>{n.d(t,{Zo:()=>r,kt:()=>u});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var d=i.createContext({}),c=function(e){var t=i.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},r=function(e){var t=c(e.components);return i.createElement(d.Provider,{value:t},e.children)},m="mdxType",s={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},k=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,d=e.parentName,r=p(e,["components","mdxType","originalType","parentName"]),m=c(n),k=a,u=m["".concat(d,".").concat(k)]||m[k]||s[k]||o;return n?i.createElement(u,l(l({ref:t},r),{},{components:n})):i.createElement(u,l({ref:t},r))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=k;var p={};for(var d in t)hasOwnProperty.call(t,d)&&(p[d]=t[d]);p.originalType=e,p[m]="string"==typeof e?e:a,l[1]=p;for(var c=2;c<o;c++)l[c]=n[c];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}k.displayName="MDXCreateElement"},27781:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>s,frontMatter:()=>o,metadata:()=>p,toc:()=>c});var i=n(87462),a=(n(67294),n(3905));const o={authors:"junkui",title:"04-\u6d45\u6790webpack5\u4e2dCompiler\u4e2d\u91cd\u8981\u7684hook\u8c03\u7528\u8fc7\u7a0b",categories:["js","webpack"],tags:["js","webpack"],date:new Date("2021-08-26T22:50:00.000Z"),sidebar_position:4},l=void 0,p={unversionedId:"webpack5\u6e90\u7801\u89e3\u6790/\u6d45\u6790webpack5\u4e2dCompiler\u4e2d\u91cd\u8981\u7684hook\u8c03\u7528\u8fc7\u7a0b",id:"webpack5\u6e90\u7801\u89e3\u6790/\u6d45\u6790webpack5\u4e2dCompiler\u4e2d\u91cd\u8981\u7684hook\u8c03\u7528\u8fc7\u7a0b",title:"04-\u6d45\u6790webpack5\u4e2dCompiler\u4e2d\u91cd\u8981\u7684hook\u8c03\u7528\u8fc7\u7a0b",description:"\u4eca\u5929\u7684\u5185\u5bb9\u53ea\u6709\u4e00\u4e2a\uff1a\u6d45\u6790 webpack5 \u4e2d Compiler \u4e2d\u91cd\u8981\u7684 hook \u8c03\u7528\u3002",source:"@site/webpack/webpack5\u6e90\u7801\u89e3\u6790/04-\u6d45\u6790webpack5\u4e2dCompiler\u4e2d\u91cd\u8981\u7684hook\u8c03\u7528\u8fc7\u7a0b.md",sourceDirName:"webpack5\u6e90\u7801\u89e3\u6790",slug:"/webpack5\u6e90\u7801\u89e3\u6790/\u6d45\u6790webpack5\u4e2dCompiler\u4e2d\u91cd\u8981\u7684hook\u8c03\u7528\u8fc7\u7a0b",permalink:"/webpack/webpack5\u6e90\u7801\u89e3\u6790/\u6d45\u6790webpack5\u4e2dCompiler\u4e2d\u91cd\u8981\u7684hook\u8c03\u7528\u8fc7\u7a0b",draft:!1,editUrl:"https://github.com/fu1996/fu1996.github.io/tree/main/webpack/webpack5\u6e90\u7801\u89e3\u6790/04-\u6d45\u6790webpack5\u4e2dCompiler\u4e2d\u91cd\u8981\u7684hook\u8c03\u7528\u8fc7\u7a0b.md",tags:[{label:"js",permalink:"/webpack/tags/js"},{label:"webpack",permalink:"/webpack/tags/webpack"}],version:"current",lastUpdatedBy:"fjk",lastUpdatedAt:1694966949,formattedLastUpdatedAt:"2023\u5e749\u670817\u65e5",sidebarPosition:4,frontMatter:{authors:"junkui",title:"04-\u6d45\u6790webpack5\u4e2dCompiler\u4e2d\u91cd\u8981\u7684hook\u8c03\u7528\u8fc7\u7a0b",categories:["js","webpack"],tags:["js","webpack"],date:"2021-08-26T22:50:00.000Z",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"03-\u8017\u65f67\u4e2a\u5c0f\u65f6\uff0c\u7528\u8fd150\u5f20\u56fe\u6765\u5b66\u4e60enhance-resolve\u4e2d\u7684\u6570\u636e\u6d41\u52a8\u548c\u63d2\u4ef6\u8c03\u5ea6\u673a\u5236",permalink:"/webpack/webpack5\u6e90\u7801\u89e3\u6790/\u8017\u65f67\u4e2a\u5c0f\u65f6\uff0c\u7528\u8fd150\u5f20\u56fe\u6765\u5b66\u4e60enhance-resolve\u4e2d\u7684\u6570\u636e\u6d41\u52a8\u548c\u63d2\u4ef6\u8c03\u5ea6\u673a\u5236"},next:{title:"05-webpack5\u4e2d\u7684\u4e8b\u4ef6\u8c03\u5ea6\u7cfb\u7edf\u548cNormalModuleFactary\u6838\u5fc3\u903b\u8f91",permalink:"/webpack/webpack5\u6e90\u7801\u89e3\u6790/webpack5\u4e2d\u7684\u4e8b\u4ef6\u8c03\u5ea6\u7cfb\u7edf\u548cNormalModuleFactary\u6838\u5fc3\u903b\u8f91"}},d={},c=[{value:"1. \u6d45\u6790<code>Compiler</code> \u4e2d\u7684\u7b2c\u4e00\u4e2a\u6838\u5fc3 hook \u662f <code>compile</code>",id:"1-\u6d45\u6790compiler-\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6838\u5fc3-hook-\u662f-compile",level:2},{value:"1.1 \u67e5\u770b\u7ed1\u5b9a <code>compile</code> \u7684\u63d2\u4ef6\u7684\u6570\u636e",id:"11-\u67e5\u770b\u7ed1\u5b9a-compile-\u7684\u63d2\u4ef6\u7684\u6570\u636e",level:3},{value:"1.2 \u603b\u7ed3",id:"12-\u603b\u7ed3",level:3},{value:"2. \u7ee7\u7eed\u8c03\u8bd5 <code>Compiler</code> \u7684 <code>compile</code> hook",id:"2-\u7ee7\u7eed\u8c03\u8bd5-compiler-\u7684-compile-hook",level:2},{value:"2.1 \u521b\u5efa <code>compilation</code> \u5929\u9009\u6253\u5de5\u4eba",id:"21-\u521b\u5efa-compilation-\u5929\u9009\u6253\u5de5\u4eba",level:3},{value:"3. Compiler \u521b\u5efa\u4e86 compilation\uff0c\u5f00\u59cb\u8c03\u7528 <code>thisCompilation</code> \u7684 hook",id:"3-compiler-\u521b\u5efa\u4e86-compilation\u5f00\u59cb\u8c03\u7528-thiscompilation-\u7684-hook",level:2},{value:"3.1 \u67e5\u770b\u7ed1\u5b9a <code>compilation</code> \u7684\u63d2\u4ef6\u7684\u6570\u636e",id:"31-\u67e5\u770b\u7ed1\u5b9a-compilation-\u7684\u63d2\u4ef6\u7684\u6570\u636e",level:3},{value:"3.2 <code>thisCompilation</code> \u7684 \u603b\u7ed3",id:"32-thiscompilation-\u7684-\u603b\u7ed3",level:3},{value:"4. Compiler \u7ee7\u7eed \u89e6\u53d1 <code>compilation</code> \u7684 hook",id:"4-compiler-\u7ee7\u7eed-\u89e6\u53d1-compilation-\u7684-hook",level:2},{value:"4.1 \u67e5\u770b\u7ed1\u5b9a<code>compilation</code>\u7684\u63d2\u4ef6\u7684\u6570\u636e",id:"41-\u67e5\u770b\u7ed1\u5b9acompilation\u7684\u63d2\u4ef6\u7684\u6570\u636e",level:3},{value:"4.2 \u8fdb\u5165 <code>ChunkPrefetchPreloadPlugin</code> \u63d2\u4ef6",id:"42-\u8fdb\u5165-chunkprefetchpreloadplugin-\u63d2\u4ef6",level:3},{value:"4.3 \u8fdb\u5165 <code>JavascriptModulesPlugin</code> \u63d2\u4ef6",id:"43-\u8fdb\u5165-javascriptmodulesplugin-\u63d2\u4ef6",level:3},{value:"4.4 \u8fdb\u5165 <code>JsonModulesPlugin</code> \u63d2\u4ef6",id:"44-\u8fdb\u5165-jsonmodulesplugin-\u63d2\u4ef6",level:3},{value:"4.5 \u8fdb\u5165 <code>AssetModulesPlugin</code> \u63d2\u4ef6",id:"45-\u8fdb\u5165-assetmodulesplugin-\u63d2\u4ef6",level:3},{value:"4.6 \u8fdb\u5165 <code>EntryPlugin</code> \u63d2\u4ef6",id:"46-\u8fdb\u5165-entryplugin-\u63d2\u4ef6",level:3},{value:"4.7 \u8fdb\u5165 <code>RuntimePlugin</code> \u63d2\u4ef6 \u3010\u6838\u5fc3\u3011",id:"47-\u8fdb\u5165-runtimeplugin-\u63d2\u4ef6-\u6838\u5fc3",level:3},{value:"4.7 \u8fdb\u5165 <code>InferAsyncModulesPlugin</code> \u63d2\u4ef6",id:"47-\u8fdb\u5165-inferasyncmodulesplugin-\u63d2\u4ef6",level:3},{value:"4.8 \u76f4\u63a5\u5e72\u5230\u6700\u540e\u4e00\u4e2a <code>WarnCaseSensitiveModulesPlugin</code> \u63d2\u4ef6",id:"48-\u76f4\u63a5\u5e72\u5230\u6700\u540e\u4e00\u4e2a-warncasesensitivemodulesplugin-\u63d2\u4ef6",level:3},{value:"4.9 \u603b\u7ed3",id:"49-\u603b\u7ed3",level:3},{value:"5 \u7ee7\u7eed <code>Compiler</code> \u7684\u4e0b\u4e00\u4e2a hook <code>make</code>",id:"5-\u7ee7\u7eed-compiler-\u7684\u4e0b\u4e00\u4e2a-hook-make",level:2},{value:"5.1 \u67e5\u770b\u7ed1\u5b9a<code>make</code>\u7684\u63d2\u4ef6\u7684\u6570\u636e",id:"51-\u67e5\u770b\u7ed1\u5b9amake\u7684\u63d2\u4ef6\u7684\u6570\u636e",level:3},{value:"5.2 \u8fdb\u5165 <code>EntryPlugin</code> \u63d2\u4ef6 \u3010 compilation \u5bf9\u8c61\u89e3\u6790\u7684\u5f00\u59cb\u3011",id:"52-\u8fdb\u5165-entryplugin-\u63d2\u4ef6--compilation-\u5bf9\u8c61\u89e3\u6790\u7684\u5f00\u59cb",level:3},{value:"5.3 \u8fdb\u5165 compilation \u4e2d \u67e5\u770b\uff0c<code>addEntry</code> \u65b9\u6cd5",id:"53-\u8fdb\u5165-compilation-\u4e2d-\u67e5\u770baddentry-\u65b9\u6cd5",level:3},{value:"5.4 \u8fdb\u5165 <code>this.addModuleTree</code> \u7684\u65b9\u6cd5",id:"54-\u8fdb\u5165-thisaddmoduletree-\u7684\u65b9\u6cd5",level:3},{value:"5.5 \u8fdb\u5165<code>this.handleModuleCreation</code> \u7684\u65b9\u6cd5",id:"55-\u8fdb\u5165thishandlemodulecreation-\u7684\u65b9\u6cd5",level:3},{value:"5.6 \u8fdb\u5165 <code>this.factorizeModule</code> \u7684\u65b9\u6cd5",id:"56-\u8fdb\u5165-thisfactorizemodule-\u7684\u65b9\u6cd5",level:3},{value:"\u8001\u89c4\u77e9\uff1a\u603b\u7ed3",id:"\u8001\u89c4\u77e9\u603b\u7ed3",level:2}],r={toc:c},m="wrapper";function s(e){let{components:t,...o}=e;return(0,a.kt)(m,(0,i.Z)({},r,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"\u4eca\u5929\u7684\u5185\u5bb9\u53ea\u6709\u4e00\u4e2a\uff1a\u6d45\u6790 webpack5 \u4e2d Compiler \u4e2d\u91cd\u8981\u7684 hook \u8c03\u7528\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(66808).Z,width:"270",height:"270"})),(0,a.kt)("h2",{id:"1-\u6d45\u6790compiler-\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6838\u5fc3-hook-\u662f-compile"},"1. \u6d45\u6790",(0,a.kt)("inlineCode",{parentName:"h2"},"Compiler")," \u4e2d\u7684\u7b2c\u4e00\u4e2a\u6838\u5fc3 hook \u662f ",(0,a.kt)("inlineCode",{parentName:"h2"},"compile")),(0,a.kt)("p",null,"\u6b64 hook \u7684\u5165\u53c2\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"params")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(69624).Z,width:"2880",height:"1800"})),(0,a.kt)("h3",{id:"11-\u67e5\u770b\u7ed1\u5b9a-compile-\u7684\u63d2\u4ef6\u7684\u6570\u636e"},"1.1 \u67e5\u770b\u7ed1\u5b9a ",(0,a.kt)("inlineCode",{parentName:"h3"},"compile")," \u7684\u63d2\u4ef6\u7684\u6570\u636e"),(0,a.kt)("p",null,"\u8fdb\u5165\u6b64 hook\uff0c\u53d1\u73b0\u53ea\u6709\u4e00\u4e2a\u76d1\u542c\u7684\u63d2\u4ef6\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"ExternalModuleFactoryPlugin"),"\u3002 ",(0,a.kt)("img",{alt:"img",src:n(40673).Z,width:"2880",height:"1800"})),(0,a.kt)("p",null,"\u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"ExternalModuleFactoryPlugin"),"\u7684\u63d2\u4ef6\u4e2d\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'class ExternalsPlugin {\n /**\n  * @param {string | undefined} type default external type\n  * @param {Externals} externals externals config\n  */\n constructor(type, externals) {\n  this.type = type;\n  this.externals = externals;\n }\n\n /**\n  * Apply the plugin\n  * @param {Compiler} compiler the compiler instance\n  * @returns {void}\n  */\n apply(compiler) {\n  compiler.hooks.compile.tap("ExternalsPlugin", ({ normalModuleFactory }) => {\n   new ExternalModuleFactoryPlugin(this.type, this.externals).apply(\n    normalModuleFactory\n   );\n  });\n }\n}\n')),(0,a.kt)("p",null,"\u53d1\u73b0\u6b64\u63d2\u4ef6 \u53c8\u5b9e\u4f8b\u5316\u4e86 \u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"ExternalModuleFactoryPlugin")," \u7684\u5bf9\u8c61\uff0c\u4f46\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"apply")," \u65b9\u6cd5\u4e0a \u4f20\u5165\u7684\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"normalModuleFactory")," \u6570\u636e\u3002\u806a\u660e\u7684\u5c0f\u4f19\u4f34\u53ef\u4ee5\u60f3\u4e00\u4e0b\u6b64\u5904\u662f\u4e3a\u4e86\u5565\uff1f \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"ExternalModuleFactoryPlugin")," \u5185\u90e8\uff0c\u770b\u4e00\u4e0b\u5176\u5185\u90e8\u5b9e\u73b0\u662f\u4ec0\u4e48\uff1f\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(75387).Z,width:"2120",height:"1566"})),(0,a.kt)("p",null,"\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u63d2\u4ef6\u5b9e\u9645\u4e0a\u4e5f\u5c31\u662f\u76d1\u542c\u4e86\u4e00\u4e0b ",(0,a.kt)("inlineCode",{parentName:"p"},"normalModuleFactory.hooks.factorize")," \u7684\u4e8b\u4ef6\u3002"),(0,a.kt)("h3",{id:"12-\u603b\u7ed3"},"1.2 \u603b\u7ed3"),(0,a.kt)("p",null,"\u603b\u4f53\u6765\u8bf4\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"Compiler")," \u91cc\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"hooks.compile")," \u7684\u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"ExternalModuleFactoryPlugin")," \u76d1\u542c\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"normalModuleFactory.hooks.factorize")," \u7684\u4e8b\u4ef6\u3002"),(0,a.kt)("h2",{id:"2-\u7ee7\u7eed\u8c03\u8bd5-compiler-\u7684-compile-hook"},"2. \u7ee7\u7eed\u8c03\u8bd5 ",(0,a.kt)("inlineCode",{parentName:"h2"},"Compiler")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"h2"},"compile")," hook"),(0,a.kt)("h3",{id:"21-\u521b\u5efa-compilation-\u5929\u9009\u6253\u5de5\u4eba"},"2.1 \u521b\u5efa ",(0,a.kt)("inlineCode",{parentName:"h3"},"compilation")," \u5929\u9009\u6253\u5de5\u4eba"),(0,a.kt)("p",null,"\u622a\u56fe\u5949\u4e0a \u4e0b\u4e00\u6b65\u7684\u903b\u8f91"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(28416).Z,width:"2880",height:"1800"})),(0,a.kt)("p",null,"\u4f1a\u53d1\u73b0\u8d70\u5230\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"newCompilation")," \u65b9\u6cd5\uff0c\u901a\u8fc7\u89c4\u8303\u7684\u547d\u540d\u5c31\u77e5\u9053\uff0c\u6b64\u65b9\u6cd5\u662f\u521b\u5efa\u4e00\u4e2a\u6b64\u6b21\u7f16\u8bd1\u6784\u5efa\u7528\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u4e00\u6b21\u6027\u5bf9\u8c61\uff0c\u6ce8\u610f\u6b64\u5904\u8bf4\u7684\u662f\u4e00\u6b21\u6027\u5bf9\u8c61\uff0c\u8868\u8ff0\u4e0a\u53ef\u80fd\u5b58\u5728\u5dee\u5f02\uff0c\u7ed9\u5144\u5f1f\u4eec\u653e\u4e0a\u89e3\u91ca\u3002\u3010\u6211\u611f\u89c9\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\u4e00\u6b21\u5b8c\u6574\u7f16\u8bd1\u6784\u5efa\u8fc7\u7a0b\u4e2d\u7684\u6570\u636e\u8f7d\u4f53\u3011\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(55930).Z,width:"2092",height:"862"})),(0,a.kt)("p",null,"\u5177\u4f53",(0,a.kt)("inlineCode",{parentName:"p"},"newCompilation"),"\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"newCompilation(params) {\n  const compilation = this.createCompilation(params); // \u4e0b\u65b9\n  compilation.name = this.name;\n  compilation.records = this.records;\n  // \u8c03\u7528 thisCompilation hook\n  this.hooks.thisCompilation.call(compilation, params);\n  // \u8c03\u7528 compilation hook\n  this.hooks.compilation.call(compilation, params);\n  return compilation;\n}\n\n\ncreateCompilation(params) {\n  this._cleanupLastCompilation();\n  return (this._lastCompilation = new Compilation(this, params));\n}\n")),(0,a.kt)("p",null,"\u6838\u5fc3\u4e5f\u5c31\u662f\u5728\u8fd9\u91cc\u4e86\uff0c\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"p"},"createCompilation")," \u4f20\u9012 ",(0,a.kt)("inlineCode",{parentName:"p"},"compiler \u548c params"),"\u53c2\u6570\uff0c\u521b\u5efa ",(0,a.kt)("inlineCode",{parentName:"p"},"Compilation")," \u7684\u5b9e\u4f8b\u5bf9\u8c61\u3002"),(0,a.kt)("p",null,"\u521b\u5efa\u5b8c\u6bd5\u4ee5\u540e\uff0c\u5f00\u59cb \u4f20\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation \u548c params")," \u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"hooks.thisCompilation"),"\u7684 hook \u4e86\u3002"),(0,a.kt)("p",null,"\u4e0b\u4e00\u6b65\u5c31\u662f\u5f00\u59cb\u8c03\u8bd5 ",(0,a.kt)("inlineCode",{parentName:"p"},"thisCompilation")," \u7684 hook\u3002"),(0,a.kt)("h2",{id:"3-compiler-\u521b\u5efa\u4e86-compilation\u5f00\u59cb\u8c03\u7528-thiscompilation-\u7684-hook"},"3. Compiler \u521b\u5efa\u4e86 compilation\uff0c\u5f00\u59cb\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"h2"},"thisCompilation")," \u7684 hook"),(0,a.kt)("h3",{id:"31-\u67e5\u770b\u7ed1\u5b9a-compilation-\u7684\u63d2\u4ef6\u7684\u6570\u636e"},"3.1 \u67e5\u770b\u7ed1\u5b9a ",(0,a.kt)("inlineCode",{parentName:"h3"},"compilation")," \u7684\u63d2\u4ef6\u7684\u6570\u636e"),(0,a.kt)("p",null,"\u7ee7\u7eed \u8c03\u8bd5\u8fdb\u5165\u6b64 hook"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(77684).Z,width:"2880",height:"1800"})),(0,a.kt)("p",null,"\u8fd9\u4e2a hook \u7adf\u7136\u6709 10 \u4e2a \u63d2\u4ef6\u76d1\u542c\u5b83\uff0c\u5148\u8fdb\u5165\u7b2c\u4e00\u4e2a\u63d2\u4ef6 ",(0,a.kt)("inlineCode",{parentName:"p"},"ArrayPushCallbackChunkFormatPlugin")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(78132).Z,width:"2264",height:"1372"})),(0,a.kt)("p",null,"\u53d1\u73b0\u8fd9\u4e2a\u63d2\u4ef6\u90fd\u662f\u5728\u7ed9 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u7ed1\u5b9a\u4e00\u4e0b \u76d1\u542c\u4e8b\u4ef6\uff0c\u5e76\u6ca1\u6709\u505a\u4ec0\u4e48\u5b9e\u9645\u7684\u64cd\u4f5c\uff0c\u7ee7\u7eed\u4e0b\u4e00\u4e2a\u63d2\u4ef6",(0,a.kt)("inlineCode",{parentName:"p"},"JsonpChunkLoadingPlugin"),"\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(45175).Z,width:"2260",height:"1586"})),(0,a.kt)("p",null,"\u8fdb\u5165\u4ee5\u540e\uff0c\u53d1\u73b0\u4e5f\u662f\u5728\u8fdb\u884c\u7ed9 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u7ed1\u5b9a\u76d1\u542c\u4e8b\u4ef6\u3002\u76f4\u63a5\u8fdb\u5165 \u6700\u540e\u4e00\u4e2a\u63d2\u4ef6",(0,a.kt)("inlineCode",{parentName:"p"},"ResolverCachePlugin")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(1334).Z,width:"2192",height:"1204"})),(0,a.kt)("p",null,"\u53d1\u73b0\u4e5f\u662f\u5728\u7ed9 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u7ed1\u5b9a\u4e00\u5806\u7684\u76d1\u542c\u4e8b\u4ef6\u3002"),(0,a.kt)("p",null,"\u597d\u5bb6\u4f19\uff0c\u8fd9\u662f\u8981\u628a ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u7ed9\u7d2f\u6b7b\u5440\uff0c"),(0,a.kt)("h3",{id:"32-thiscompilation-\u7684-\u603b\u7ed3"},"3.2 ",(0,a.kt)("inlineCode",{parentName:"h3"},"thisCompilation")," \u7684 \u603b\u7ed3"),(0,a.kt)("p",null,"\u603b\u7ed3\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"Compiler")," \u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"thisCompilation")," \u7684 hook\uff0c\u5c31\u662f\u5728\u75af\u72c2\u7684\u7ed9 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u901a\u8fc7\u5404\u79cd\u63d2\u4ef6 \u6302\u5404\u79cd\u7684 \u76d1\u542c\u4e8b\u4ef6\uff0c\u5f39\u836f\u51c6\u5907\u5b8c\u6bd5\uff0c\u7b49\u5f85\u4e00\u89e6\u5373\u53d1\u3002"),(0,a.kt)("p",null,"\uff08",(0,a.kt)("inlineCode",{parentName:"p"},"compilation"),"\u5185\u5fc3\u60f3\u6cd5\uff1a\u6211\u53ef\u771f\u662f\u592a\u96be\u4e86\u3002\u3002\u3002\uff09"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(90983).Z,width:"387",height:"376"})),(0,a.kt)("h2",{id:"4-compiler-\u7ee7\u7eed-\u89e6\u53d1-compilation-\u7684-hook"},"4. Compiler \u7ee7\u7eed \u89e6\u53d1 ",(0,a.kt)("inlineCode",{parentName:"h2"},"compilation")," \u7684 hook"),(0,a.kt)("h3",{id:"41-\u67e5\u770b\u7ed1\u5b9acompilation\u7684\u63d2\u4ef6\u7684\u6570\u636e"},"4.1 \u67e5\u770b\u7ed1\u5b9a",(0,a.kt)("inlineCode",{parentName:"h3"},"compilation"),"\u7684\u63d2\u4ef6\u7684\u6570\u636e"),(0,a.kt)("p",null,"\u7ee7\u7eed\u8fdb\u884c\u4e0b\u4e00\u6b65 \u8c03\u8bd5\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(66115).Z,width:"2880",height:"1800"})),(0,a.kt)("p",null,"\u6211\u76f4\u63a5\u75af\u4e86\u554a\uff0c\u8fd9",(0,a.kt)("inlineCode",{parentName:"p"},"Compiler")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u7684 hook \u7adf\u7136\u7ed1\u5b9a\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"54")," \u4e2a\u76d1\u542c\u7684\u63d2\u4ef6\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(21586).Z,width:"300",height:"300"})),(0,a.kt)("p",null,"\u6211 giao \u54e5 \u76f4\u63a5\u75af\u6389\u3002\u800c\u6211\u548c\u5927\u5bb6\u4f5c\u4e3a\u4f18\u79c0\u7684 \u7a0b\u5e8f\u5458\uff0c\u90a3\u4e0d\u5c31\u662f\u591a\u70b9 54 \u6b21\u8c03\u8bd5\u5417\uff1f \u8fdb\u5165\u7b2c\u4e00\u4e2a\u63d2\u4ef6 ",(0,a.kt)("inlineCode",{parentName:"p"},"ChunkPrefetchPreloadPlugin")),(0,a.kt)("h3",{id:"42-\u8fdb\u5165-chunkprefetchpreloadplugin-\u63d2\u4ef6"},"4.2 \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"h3"},"ChunkPrefetchPreloadPlugin")," \u63d2\u4ef6"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(23710).Z,width:"2126",height:"1484"})),(0,a.kt)("p",null,"\u8fd9\u53c8\u662f\u7ed9 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u5bf9\u8c61 \u3010\u6ce8\u610f\u4e0d\u662f hook \u540d\u79f0\u3011\uff0c\u7ed1\u5b9a\u4e86\u4e00\u8eab\u7684 \u76d1\u542c\u4e8b\u4ef6\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(39351).Z,width:"270",height:"270"})),(0,a.kt)("p",null,"\u7ee7\u7eed\u770b\u4e0b\u4e00\u4e2a\u63d2\u4ef6\u7684\uff0c\u4e0b\u4e00\u4e2a\u63d2\u4ef6\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"JavascriptModulesPlugin")),(0,a.kt)("h3",{id:"43-\u8fdb\u5165-javascriptmodulesplugin-\u63d2\u4ef6"},"4.3 \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"h3"},"JavascriptModulesPlugin")," \u63d2\u4ef6"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"JavascriptModulesPlugin")," \u7684\u4ee3\u7801\u5982\u4e0b\uff1a ",(0,a.kt)("img",{alt:"img",src:n(95998).Z,width:"2282",height:"1584"})),(0,a.kt)("p",null,"\u770b\u5230\u4e86\u4e0a\u9762\u7684\u4e00\u90e8\u5206\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u5bf9\u8c61\u7ec8\u4e8e\u5f00\u5fc3\u4e86\uff0c\u7ec8\u4e8e\u4e0d\u4ec5\u4ec5\u662f\u7ed9\u6211\u7ed1\u5b9a\u76d1\u542c\u4e8b\u4ef6\u4e86\uff0c\u8fd9\u6b21\u8f6e\u5230\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"normalModuleFactory"),"\uff0c\u5fc3\u91cc\u7f8e\u6ecb\u6ecb\u3002"),(0,a.kt)("p",null,"\u7ee7\u7eed\u770b\u4e0b\u9762\u4e00\u90e8\u5206\u4ee3\u7801\uff0c"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(17832).Z,width:"2306",height:"1656"})),(0,a.kt)("p",null,"\u53bb\u6c42\u5427\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u5bf9\u8c61\u8fd8\u662f\u9003\u4e0d\u8fc7\u88ab\u7ed1\u5b9a\u76d1\u542c\u4e8b\u4ef6\u7684\u547d\u8fd0\uff0c\u3010\u6ce8\u610f\u6b64\u5904\u7684 hook \u540d\u79f0\u662f\u4e0d\u540c\u7684\u3011\u3002"),(0,a.kt)("p",null,"\u7ee7\u7eed\u8fdb\u5165\u4e0b\u4e00\u4e2a\u63d2\u4ef6"),(0,a.kt)("h3",{id:"44-\u8fdb\u5165-jsonmodulesplugin-\u63d2\u4ef6"},"4.4 \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"h3"},"JsonModulesPlugin")," \u63d2\u4ef6"),(0,a.kt)("p",null,"\u7ed9 ",(0,a.kt)("inlineCode",{parentName:"p"},"normalModuleFactory")," \u7ed1\u5b9a \u76d1\u542c\u4e8b\u4ef6 ",(0,a.kt)("img",{alt:"img",src:n(89826).Z,width:"1790",height:"1284"})),(0,a.kt)("h3",{id:"45-\u8fdb\u5165-assetmodulesplugin-\u63d2\u4ef6"},"4.5 \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"h3"},"AssetModulesPlugin")," \u63d2\u4ef6"),(0,a.kt)("p",null,"\u7ed9 ",(0,a.kt)("inlineCode",{parentName:"p"},"normalModuleFactory"),"\u548c",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u7ed1\u5b9a \u76d1\u542c\u4e8b\u4ef6 ",(0,a.kt)("img",{alt:"img",src:n(19110).Z,width:"2256",height:"1374"})),(0,a.kt)("h3",{id:"46-\u8fdb\u5165-entryplugin-\u63d2\u4ef6"},"4.6 \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"h3"},"EntryPlugin")," \u63d2\u4ef6"),(0,a.kt)("p",null,"\u8fd9\u4e2a\u63d2\u4ef6 \u7ec8\u4e8e\u4e0d\u7ed1\u5b9a\u4e8b\u4ef6\u4e86\uff0c\u4ec5\u4ec5\u662f \u5411 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation.dependencyFactories")," \u4e2d\u585e\u5165\u4e86\u4e00\u5bf9\u6570\u636e\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(4506).Z,width:"2286",height:"1710"})),(0,a.kt)("h3",{id:"47-\u8fdb\u5165-runtimeplugin-\u63d2\u4ef6-\u6838\u5fc3"},"4.7 \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"h3"},"RuntimePlugin")," \u63d2\u4ef6 \u3010\u6838\u5fc3\u3011"),(0,a.kt)("p",null,"\u8fd9\u4e2a\u63d2\u4ef6\u7684\u4ee3\u7801\u91cf\u662f\u771f\u7684\u591a\uff0c\u770b\u540d\u5b57\u5206\u6790\u8fd9\u4e2a\u63d2\u4ef6\u5e94\u8be5\u662f\u5904\u7406\u8fd0\u884c\u65f6\u7684\u6570\u636e ",(0,a.kt)("img",{alt:"img",src:n(76953).Z,width:"2248",height:"1558"})),(0,a.kt)("p",null,"\u7b80\u5355\u770b\u4e0b\u91cc\u9762\u7684\u90e8\u5206\u5185\u5bb9\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(3198).Z,width:"2288",height:"1584"})),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(92006).Z,width:"2228",height:"1600"})),(0,a.kt)("h3",{id:"47-\u8fdb\u5165-inferasyncmodulesplugin-\u63d2\u4ef6"},"4.7 \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"h3"},"InferAsyncModulesPlugin")," \u63d2\u4ef6"),(0,a.kt)("p",null,"\u7ed9 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u7ed1\u5b9a \u76d1\u542c\u4e8b\u4ef6 ",(0,a.kt)("img",{alt:"img",src:n(97753).Z,width:"1460",height:"604"})),(0,a.kt)("h3",{id:"48-\u76f4\u63a5\u5e72\u5230\u6700\u540e\u4e00\u4e2a-warncasesensitivemodulesplugin-\u63d2\u4ef6"},"4.8 \u76f4\u63a5\u5e72\u5230\u6700\u540e\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"h3"},"WarnCaseSensitiveModulesPlugin")," \u63d2\u4ef6"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(71300).Z,width:"2014",height:"952"})),(0,a.kt)("p",null,"\u4e5f\u662f\u5728\u7ed9 \u8f9b\u82e6\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u7684\u8eab\u4e0a \u6302\u8f7d\u76d1\u542c\u4e8b\u4ef6\u3002"),(0,a.kt)("h3",{id:"49-\u603b\u7ed3"},"4.9 \u603b\u7ed3"),(0,a.kt)("p",null,"\u603b\u7684\u6765\u8bf4\uff0c Compiler \u89e6\u53d1 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u7684 hook \u672c\u8d28\u4e0a\u662f\u7ed9\u6211\u4eec\u8f9b\u52e4\u7684\u6253\u5de5\u4eba ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation"),"\u5bf9\u8c61 \u7684 \u4e0d\u540c\u7684\u6570\u636e\u5904\u7406\u9636\u6bb5 \u7ed1\u5b9a\u4e0d\u540c\u7684\u63d2\u4ef6\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(81137).Z,width:"270",height:"270"})),(0,a.kt)("h2",{id:"5-\u7ee7\u7eed-compiler-\u7684\u4e0b\u4e00\u4e2a-hook-make"},"5 \u7ee7\u7eed ",(0,a.kt)("inlineCode",{parentName:"h2"},"Compiler")," \u7684\u4e0b\u4e00\u4e2a hook ",(0,a.kt)("inlineCode",{parentName:"h2"},"make")),(0,a.kt)("p",null,"\u8d70\u5b8c ",(0,a.kt)("inlineCode",{parentName:"p"},"this.newCompilation(params);")," \u7684\u8c03\u7528\u6d41\u7a0b\u540e\uff0c\u4e0b\u4e00\u6b65\u5c31\u662f\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"Compiler")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"make")," \u7684 hook \u4e86\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(97541).Z,width:"2818",height:"1272"})),(0,a.kt)("h3",{id:"51-\u67e5\u770b\u7ed1\u5b9amake\u7684\u63d2\u4ef6\u7684\u6570\u636e"},"5.1 \u67e5\u770b\u7ed1\u5b9a",(0,a.kt)("inlineCode",{parentName:"h3"},"make"),"\u7684\u63d2\u4ef6\u7684\u6570\u636e"),(0,a.kt)("p",null,"nice \u7684\u5f88\uff0c\u8fd9\u4e2a hook \u4ec5\u4ec5 \u6709\u4e00\u4e2a\u53eb ",(0,a.kt)("inlineCode",{parentName:"p"},"EntryPlugin")," \u7684\u63d2\u4ef6\u8fdb\u884c\u7ed1\u5b9a\u3002 ",(0,a.kt)("img",{alt:"img",src:n(37908).Z,width:"2628",height:"1650"})),(0,a.kt)("h3",{id:"52-\u8fdb\u5165-entryplugin-\u63d2\u4ef6--compilation-\u5bf9\u8c61\u89e3\u6790\u7684\u5f00\u59cb"},"5.2 \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"h3"},"EntryPlugin")," \u63d2\u4ef6 \u3010 compilation \u5bf9\u8c61\u89e3\u6790\u7684\u5f00\u59cb\u3011"),(0,a.kt)("p",null,"\u6838\u5fc3\u4ee3\u7801\u622a\u56fe\u5982\u4e0b\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(99820).Z,width:"2214",height:"1238"})),(0,a.kt)("p",null,"\u4f60\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u63d2\u4ef6\u5c31\u662f\u8c03\u7528\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation.addEntry")," \u7684\u65b9\u6cd5\uff0c\u6ca1\u6709\u505a\u5176\u4ed6\u903b\u8f91\u3002\u90a3\u5c31\u5f00\u59cb\u5206\u6790\u6b64\u51fd\u6570\u7684\u5165\u53c2\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"context, dep, options"),"\u3002 \u67e5\u770b\u4e00\u4e0b\u5165\u53c2\u7684\u6570\u636e\uff0c\u5982\u4e0b\u56fe ",(0,a.kt)("img",{alt:"img",src:n(57683).Z,width:"2298",height:"1490"})),(0,a.kt)("p",null,"\u4f60\u5c31\u4f1a\u663e\u800c\u6613\u89c1\u7684\u53d1\u73b0 ",(0,a.kt)("inlineCode",{parentName:"p"},"dep")," \u8fd9\u4e2a\u662f\u4e3b\u89d2\u4e86\uff0c\u90a3 ",(0,a.kt)("inlineCode",{parentName:"p"},"dep")," \u53c8\u662f\u7531 ",(0,a.kt)("inlineCode",{parentName:"p"},"const dep = EntryPlugin.createDependency(entry, options);")," \u521b\u5efa\u7684\uff0c\u67e5\u770b ",(0,a.kt)("inlineCode",{parentName:"p"},"createDependency")," \u9759\u6001\u65b9\u6cd5\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'static createDependency(entry, options) {\n  // \u521b\u5efa\u4e86 EntryDependency \u7ee7\u627f\u81ea ModuleDependency \u7ee7\u627f\u81ea Dependency \uff08\u62bd\u8c61\u7c7b\uff09\n  const dep = new EntryDependency(entry);\n  // TODO webpack 6 remove string option\n  dep.loc = { name: typeof options === "object" ? options.name : options };\n  return dep;\n }\n')),(0,a.kt)("p",null,"\u76f4\u63a5\u770b \u8fd9\u4e2a dep \u5bf9\u8c61\u7684\u6570\u636e \u90fd\u6709\u5565\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(95006).Z,width:"2122",height:"1716"})," webpack.config.js \u914d\u7f6e\u5982\u4e0b\uff1a ",(0,a.kt)("img",{alt:"img",src:n(4326).Z,width:"1700",height:"668"})),(0,a.kt)("p",null,"\u662f\u4e0d\u662f\u770b\u5230\u4e86\uff0c\u719f\u6089\u7684 webpack \u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"entry \u7684\u8def\u5f84")," \u548c \u6b64 dep \u5bf9\u8c61\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"request")," \u5c5e\u6027\u662f\u4e00\u81f4\u7684\u5462\uff1f"),(0,a.kt)("h3",{id:"53-\u8fdb\u5165-compilation-\u4e2d-\u67e5\u770baddentry-\u65b9\u6cd5"},"5.3 \u8fdb\u5165 compilation \u4e2d \u67e5\u770b\uff0c",(0,a.kt)("inlineCode",{parentName:"h3"},"addEntry")," \u65b9\u6cd5"),(0,a.kt)("p",null,"\u4e0a\u4ee3\u7801"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'addEntry(context, entry, optionsOrName, callback) {\n  console.log("add entry");\n  // TODO webpack 6 remove\n  const options =\n   typeof optionsOrName === "object"\n    ? optionsOrName\n    : { name: optionsOrName };\n\n  this._addEntryItem(context, entry, "dependencies", options, callback);\n }\n')),(0,a.kt)("p",null,"\u6b64\u51fd\u6570\u4ec5\u4ec5\u662f\u505a\u4e86\u6570\u636e\u5904\u7406\uff0c\u771f\u6b63\u5e72\u6d3b\u7684\u8fd8\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"this._addEntryItem")," \u51fd\u6570\u4e2d\uff0c\u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"this._addEntryItem"),"\u51fd\u6570"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(4054).Z,width:"2238",height:"1168"})),(0,a.kt)("p",null,"\u4f60\u4f1a\u53d1\u73b0\u6b64\u51fd\u6570 \u8c03\u7528\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"this.hooks.addEntry"),"\u3010\u6ce8\u610f\u6b64\u65f6\u7684 this \u6307\u7684\u7684\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u5bf9\u8c61\u3011\uff0c\u8fdb\u5165\u6b64 hook"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(13400).Z,width:"2284",height:"1688"})),(0,a.kt)("p",null,"\u5e76\u6ca1\u6709\u63d2\u4ef6 \u76d1\u542c\u5b83\uff0c\u76f4\u63a5\u8fdb\u5165\u4e0b\u4e00\u884c\u4ee3\u7801\uff1a\u8c03\u7528",(0,a.kt)("inlineCode",{parentName:"p"},"this.addModuleTree")," \u65b9\u6cd5\u3002"),(0,a.kt)("h3",{id:"54-\u8fdb\u5165-thisaddmoduletree-\u7684\u65b9\u6cd5"},"5.4 \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"h3"},"this.addModuleTree")," \u7684\u65b9\u6cd5"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(39107).Z,width:"2262",height:"1430"})),(0,a.kt)("p",null,"\u5904\u7406\u5b8c\u6570\u636e\u4ee5\u540e\uff0c\u53c8\u8fdb\u5165\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"p"},"this.handleModuleCreation")," \u7684\u65b9\u6cd5\u3002"),(0,a.kt)("h3",{id:"55-\u8fdb\u5165thishandlemodulecreation-\u7684\u65b9\u6cd5"},"5.5 \u8fdb\u5165",(0,a.kt)("inlineCode",{parentName:"h3"},"this.handleModuleCreation")," \u7684\u65b9\u6cd5"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(2217).Z,width:"2180",height:"1338"})),(0,a.kt)("p",null,"\u53c8\u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"this.factorizeModule")," \u7684\u65b9\u6cd5"),(0,a.kt)("h3",{id:"56-\u8fdb\u5165-thisfactorizemodule-\u7684\u65b9\u6cd5"},"5.6 \u8fdb\u5165 ",(0,a.kt)("inlineCode",{parentName:"h3"},"this.factorizeModule")," \u7684\u65b9\u6cd5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'// Workaround for typescript as it doesn\'t support function overloading in jsdoc within a class\nCompilation.prototype.factorizeModule = /** @type {{\n (options: FactorizeModuleOptions & { factoryResult?: false }, callback: ModuleCallback): void;\n (options: FactorizeModuleOptions & { factoryResult: true }, callback: ModuleFactoryResultCallback): void;\n}} */ (\n function (options, callback) {\n  console.log("add entry to factorize Queue, real job start");\n  this.factorizeQueue.add(options, callback);\n }\n);\n')),(0,a.kt)("p",null,"\u4f60\u4f1a\u53d1\u73b0\u5b83\u662f\u5728 Compilation \u7684\u539f\u578b\u4e0a\u7ed1\u5b9a\u7684\u4e00\u4e2a\u65b9\u6cd5,\u5176\u4e3b\u8981\u7684\u4f5c\u7528\u5c31\u662f \u5411 ",(0,a.kt)("inlineCode",{parentName:"p"},"factorizeQueue")," \u4e2d\u6dfb\u52a0\u4e86\u4e00\u4e2a\u6570\u636e\u3002\u7136\u540e\u5c31\u4e48\u6709\u7136\u540e\u4e86\uff1f\uff1f\uff1f\uff1f"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(88190).Z,width:"270",height:"270"})),(0,a.kt)("h2",{id:"\u8001\u89c4\u77e9\u603b\u7ed3"},"\u8001\u89c4\u77e9\uff1a\u603b\u7ed3"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"Compiler")," \u91cc\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"hooks.compile")," \u7684\u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"li"},"ExternalModuleFactoryPlugin")," \u76d1\u542c\u4e86 ",(0,a.kt)("inlineCode",{parentName:"li"},"normalModuleFactory.hooks.factorize")," \u7684\u4e8b\u4ef6\u3002"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"Compiler")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"compile")," hook \u4f20\u9012 ",(0,a.kt)("inlineCode",{parentName:"li"},"compiler \u548c params"),"\u53c2\u6570 \u7ed9 ",(0,a.kt)("inlineCode",{parentName:"li"},"createCompilation")," \u65b9\u6cd5\uff0c\u521b\u5efa ",(0,a.kt)("inlineCode",{parentName:"li"},"Compilation")," \u7684\u5b9e\u4f8b\u5bf9\u8c61 ",(0,a.kt)("inlineCode",{parentName:"li"},"compilation")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"Compiler")," \u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"thisCompilation")," \u7684 hook\uff0c\u5c31\u662f\u5728\u75af\u72c2\u7684\u7ed9 ",(0,a.kt)("inlineCode",{parentName:"li"},"compilation"),"\u5bf9\u8c61 \u901a\u8fc7\u5404\u79cd\u63d2\u4ef6 \u6302\u5404\u79cd\u7684 \u76d1\u542c\u4e8b\u4ef6\uff0c\u5f39\u836f\u51c6\u5907\u5b8c\u6bd5\uff0c\u7b49\u5f85\u4e00\u89e6\u5373\u53d1"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"Compiler")," \u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"compilation")," \u7684 hook \u672c\u8d28\u4e0a\u4e5f\u662f\u7ed9\u6211\u4eec\u8f9b\u52e4\u7684\u6253\u5de5\u4eba ",(0,a.kt)("inlineCode",{parentName:"li"},"compilation"),"\u5bf9\u8c61\u7684",(0,a.kt)("inlineCode",{parentName:"li"},"\u4e0d\u540c\u7684\u6570\u636e\u5904\u7406"),"\u9636\u6bb5\uff0c\u7ed1\u5b9a\u4e0d\u540c\u7684\u63d2\u4ef6\u3002"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"Compiler"),"\u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"make")," \u7684 hook\uff0c\u4e3b\u8981\u662f \u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"li"},"EntryPlugin")," \u63d2\u4ef6\uff0c\u89e3\u6790\u6211\u4eec\u4f20\u5165\u7684 entry \u5c5e\u6027\uff0c\u5e76\u8c03\u7528 ",(0,a.kt)("inlineCode",{parentName:"li"},"compilation.addEntry")," \u7684\u65b9\u6cd5\uff0c\u8fdb\u800c\u901a\u8fc7\u4e00\u7cfb\u5217\u7684\u6570\u636e\u5904\u7406\uff0c\u6700\u540e\u5c06\u6570\u636e\u585e\u5165\u5230 ",(0,a.kt)("inlineCode",{parentName:"li"},"compilation")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"factorizeQueue")," \u4e2d\u3002")),(0,a.kt)("p",null,"\u5728\u4e00\u4e2a\u7c7b\u4f3c \u961f\u5217\u7684\u6570\u636e\u4e2d\u6dfb\u52a0\u4e86\uff0c\u5c31\u6ca1\u6709\u7136\u540e\u4e86\u5417\uff1f\u5230\u5e95\u600e\u4e48\u5f00\u59cb\u542f\u52a8\u7684\u5462\uff1f\u600e\u4e48\u6ca1\u6709\u89c1\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"compilation")," \u8c03\u7528\u4e4b\u524d\u7684 hook \u5462\uff1f"),(0,a.kt)("p",null,"\u5176\u5b9e\u4e0a\u9762\u7684\u7591\u95ee\u90fd\u4f1a\u5728\u4e0b\u4e00\u7bc7\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"webpack5 \u4e2d\u7684 \u4efb\u52a1\u8c03\u5ea6"),"\u4e2d\uff0c\u8fdb\u884c\u8bb2\u89e3\uff0c\u656c\u8bf7\u671f\u5f85\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"img",src:n(67048).Z,width:"270",height:"270"})),(0,a.kt)("p",null,"\u5982\u679c\u6709\u5fcd\u4e0d\u4f4f\u7684\u5c0f\u4f19\u4f34\u4eec\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u53bb\u8c03\u8bd5\u4e00\u4e0b webpack5 \u76f8\u5173\u7684\u6e90\u7801\uff0c\u6b22\u8fce\u4e00\u8d77\u5b66\u4e60\u4ea4\u6d41\u3002\u5144\u5f1f\u4eec\u4e0b\u7bc7\u6587\u7ae0\u518d\u89c1\u3002"))}s.isMDXComponent=!0},66808:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/00Ij856KwySf46KdwTb6xuwyGLSJPRXI-20a1fec57880e7c5a289d5ae805586b0.gif"},77684:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/0354e21e-6936-4760-9419-c2af8c24938b-ff4297a9aa7459702ab9b640069d685a.png"},2217:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/08888965-c64c-4ee0-993d-fe1de8ca158f-5bed63333096efadaffcea68a0596a4e.png"},99820:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/14715427-ba7b-4203-9e4c-4271efa87c17-2371c688585b7a437038e94a50b53df6.png"},4326:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/1613e7ff-e877-44dc-9a2e-7604d0812c63-f3736f41814ab00043df4ca2b8e4d639.png"},71300:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/1a54db9e-9875-41b5-85f5-bce46d92ff3f-260657980ae316999d063743ffc8cfdb.png"},4054:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/2709907b-4ba3-447e-afb7-c8116f5ead51-4a893f4b559a947cb527e33531aa538c.png"},92006:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/39ab49cf-df7c-4e3f-b1bd-819946aa622c-d345d0fac382868075976e2750bbe07f.png"},45175:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/4a2abf9b-d7bd-4989-9316-e59693b1ae07-9691028cfc55ebc8bdd527c373e84395.png"},95998:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/56ee42c6-11b6-437f-9831-825eb2a77bd4-397a88a2142f2b481cde4d306f65ac3c.png"},97541:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/5a7543d1-cbbc-4273-ac8d-49b3150b5265-6d8ff73fd919a0d39d620279f4392650.png"},17832:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/6d1a2d84-70a0-498a-9361-8a2c041aaa81-79881f1b80610b5caf6857c617c4a10d.png"},4506:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/865311bf-a72d-48ff-a9a7-6b3ee856255d-1d78eeb832f2ecdbb71d9c62b2a93a4a.png"},55930:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/8e8763f8-b9dc-448c-8992-6345e12fb54e-674c11c9bff3b38f8d8900a1d1555ed0.png"},97753:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/92ae1364-cbe2-41c4-b2d2-870c1e4ae175-8e26b7e7a1b621df8326a58041bf98bf.png"},95006:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/98ef1dd8-f75f-453d-b050-bbcc43274b42-c84b0990f9a2b5fe36edb7fe24cc4450.png"},69624:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/9d7c9ea1-8bf2-4e76-bacb-183709c6a810-854c5f1482f327d76cfbb905258b0cf2.png"},81137:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/CeOJzsla4jCASmTI8zY1mSjE96QDuVLx-e98070c3de491d0754cce1346dfbd3f5.gif"},67048:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/F3So7peHp4zwn04LNywPB9gHmhPWTwvv-473e06fb80765eb3fd595d905687dee1.gif"},39351:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/SKGzVD53WQQXDcUyru84UmkPkNkXKOqc-127d277444ab213cd38adf55407c591a.gif"},75387:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/a35e4722-0df3-40e5-82ed-7b9112c83315-91bdac2cc3cb745c7e849fc3bdb02c98.png"},76953:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/a60e5021-fc9a-4d17-92da-c9383bf6ebe3-2db10dfc2db2a80c55b5f9708fbd2eec.png"},66115:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/bc7d86e5-72c3-41ab-9b22-e0e85fe5145c-711f4c1e9dd021a9275d4d7f2834994d.png"},57683:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/bcd22ed0-1b7e-40e8-b1c6-7411319348e9-ad6f38b3ac76607ba797354a40107a27.png"},40673:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/bf3fa7cb-2fdf-4f92-94fc-f0721c8da533-f036c9db76e4e940a38219d0a179a985.png"},28416:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/cb2c8088-b159-446d-99be-8749eb5fab4f-0aabe5a0320e9959af49fb63616495a9.png"},89826:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/cfd8ccf0-21e2-42c6-a7fc-29d6cd88ccbe-0f41b4881149422654b4048e9324fbaf.png"},78132:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/d5f1f04d-ea23-4fbb-94fb-2b3d66f98158-aafb322443e50ea1c63129df9cfdb252.png"},13400:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/e6174cd8-4776-4d18-9c59-ef8c0882d425-a4d430898e1dffeee002d02b68ea3f65.png"},19110:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/e684ce21-4400-4e24-a04a-e221d99a4bf7-1b05b013e82e783e85e888c6a8600012.png"},1334:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/e6b97470-3204-45ea-88cf-cafb625dbf1a-90c04f4c07fbe5c89f60b9224f78387b.png"},37908:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/e7acf69c-73dd-4e19-ae01-6e2acf442237-4a253995442b5bdafc08da8623df3e2a.png"},39107:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/f0adfbaf-ce49-4927-9332-c4d9cf083ae9-091a3d7cbe5e4f97f0757e2d3ef94a6f.png"},23710:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/f7793158-a1dd-4dad-8691-65bdd2245157-1081cf8f5fc412c470ac0bf3eeeebd6c.png"},3198:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/f9dbf898-d53e-4aab-aeb3-00f8bfad88da-d78c6a1b31f2b8cfe359faac5654c958.png"},88190:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/o6nMBYRQV56H8lykZdw9VCrEh68zosR2-b73ea58e8b904800f56bb8bdf3280752.gif"},21586:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/rJgfWqM4KUXJx528NqbBSLgy6lT283HY-6b50ae90215a8318c56bb4045ca4a8c6.jpeg"},90983:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/rXvzbOjOrl1EiAuwtQpl2TmuwrVUJHJo-0b780d27191040009d21ccb0a49cb8ca.png"}}]);