<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-react docs-doc-id-å»ºé€ ä½ è‡ªå·±çš„reactï¼ˆä¸Šï¼‰">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">å»ºé€ ä½ è‡ªå·±çš„Reactï¼ˆä¸Šï¼‰ | ä¿Šå¥</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fu1996.github.io/react/build-your-react-01"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-react-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-react-current"><meta data-rh="true" property="og:title" content="å»ºé€ ä½ è‡ªå·±çš„Reactï¼ˆä¸Šï¼‰ | ä¿Šå¥"><meta data-rh="true" name="description" content="å£°æ˜"><meta data-rh="true" property="og:description" content="å£°æ˜"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fu1996.github.io/react/build-your-react-01"><link data-rh="true" rel="alternate" href="https://fu1996.github.io/react/build-your-react-01" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://fu1996.github.io/react/build-your-react-01" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ä¿Šå¥ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ä¿Šå¥ Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="ä¿Šå¥" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.634bf5fc.css">
<link rel="preload" href="/assets/js/runtime~main.48e50162.js" as="script">
<link rel="preload" href="/assets/js/main.ded34950.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="è·³åˆ°ä¸»è¦å†…å®¹"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">è·³åˆ°ä¸»è¦å†…å®¹</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">â­ï¸ å¦‚æœè¿™ä¸ªç½‘ç«™èƒ½å¸®åŠ©åˆ°ä½ ï¼Œæ¬¢è¿ç»™ä¸€ä¸ªstaræ”¯æŒä½œè€…  <a target="_blank" rel="noopener noreferrer" href="https://github.com/fu1996/fu1996.github.io">GitHub</a></div><button type="button" aria-label="å…³é—­" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="ä¸»å¯¼èˆª" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="åˆ‡æ¢å¯¼èˆªæ " aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">ä¿Šå¥</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" docid="me">æˆ‘å’Œåšå®¢ ğŸ“</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/me">ä»å¤§å­¦åˆ°ç¤¾ä¼š</a></li><li><a class="dropdown__link" href="/blog">åšå®¢</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">å‰ç«¯çŸ¥è¯†åº“ ğŸ’¡</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/html-css">HTMLå’ŒCSS</a></li><li><a class="dropdown__link" href="/js">JavaScript</a></li><li><a class="dropdown__link" href="/ts">TypeScript</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/react/build-your-react-01">React</a></li><li><a class="dropdown__link" href="/babel">Babel åŸç†</a></li><li><a class="dropdown__link" href="/webpack">Webpack æºç </a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">åç«¯çŸ¥è¯†åº“ ğŸ“–</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/linux">Linux</a></li><li><a class="dropdown__link" href="/python">Python</a></li><li><a class="dropdown__link" href="/mysql">Mysql</a></li><li><a class="dropdown__link" href="/docker">Docker</a></li><li><a class="dropdown__link" href="/k8s">K8s</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">å­¦ä¹ è¯¾ä»¶ ğŸ«</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_blank" href="/fe/index.html">å‰ç«¯åŸºç¡€ï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/py/01day/01_æ“ä½œç³»ç»Ÿï¼ˆç§‘æ™®ç« èŠ‚ï¼‰.html">Python é«˜çº§ï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/flask/index.html">Flaskï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/django/index.html">Djangoï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/py-mp/index.html">å¾®ä¿¡å¼€å‘ï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/redis/index.html">Redisï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/celery/index.html">Celeryï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/scrapy/index.html">Scrapyï¼ˆè€ï¼‰</a></li></ul></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="æœç´¢" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/fu1996/fu1996.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="å›åˆ°é¡¶éƒ¨" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><b>ä¿Šå¥</b></a><nav aria-label="æ–‡æ¡£ä¾§è¾¹æ " class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/react/build-your-react-01">å»ºé€ ä½ è‡ªå·±çš„Reactï¼ˆä¸Šï¼‰</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/react/build-your-react-02">å»ºé€ ä½ è‡ªå·±çš„Reactï¼ˆä¸‹ï¼‰</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/react/">reactä¸­ä½¿ç”¨å¼•ç”¨ç±»å‹çš„æ³¨æ„äº‹é¡¹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/react/redux-sageçš„æ•°æ®çš„æµåŠ¨">redux-sageçš„æ•°æ®çš„æµåŠ¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/react/æ·±å…¥redux">æ·±å…¥redux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/react/é¡¹ç›®ä¸­å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“">é¡¹ç›®ä¸­å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“</a></li></ul></nav><button type="button" title="æ”¶èµ·ä¾§è¾¹æ " aria-label="æ”¶èµ·ä¾§è¾¹æ " class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">æœ¬é¡µæ€»è§ˆ</button></div><div class="theme-doc-markdown markdown"><header><h1>å»ºé€ ä½ è‡ªå·±çš„Reactï¼ˆä¸Šï¼‰</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="å£°æ˜">å£°æ˜<a href="#å£°æ˜" class="hash-link" aria-label="å£°æ˜çš„ç›´æ¥é“¾æ¥" title="å£°æ˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è½¬è½½è‡ª<a href="https://twitter.com/pomber" target="_blank" rel="noopener noreferrer">Rodrigo Pombo</a>çš„åšæ–‡<a href="https://pomb.us/build-your-own-react/" target="_blank" rel="noopener noreferrer">Build your own React</a>ï¼ŒåŒæ—¶å­¦ä¹ äº†ç¿»è¯‘è¿‡å”é¼å¤§ä½¬çš„<a href="https://www.tangdingblog.cn/blog/react/buildyourownreact-2020-09-22/#reconciliation" target="_blank" rel="noopener noreferrer">ä¸­æ–‡ç‰ˆçš„æ–‡æ¡£ </a>ï¼Œæœ‰æ‰€æ„Ÿæ‚Ÿï¼Œæ‰€ä»¥æ‰“ç®—å†æŒ‰ç…§è‡ªå·±çš„ç†è§£ï¼Œå»ç¨å¾®åŠ å·¥ä¸€ä¸‹ï¼ŒåŠ æ·±ä¸€ä¸‹è®°å¿†å’Œç†æ¸…ç»†èŠ‚ã€‚</p><blockquote><p>å£°æ˜ï¼šæœ¬æ–‡é100%åŸåˆ›ï¼Œæ˜¯è½¬è½½æ–‡ï¼Œä¸”å·²è·å¾—è½¬è½½æˆæƒğŸ˜Š</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-å¤§çº²">1. å¤§çº²<a href="#1-å¤§çº²" class="hash-link" aria-label="1. å¤§çº²çš„ç›´æ¥é“¾æ¥" title="1. å¤§çº²çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>é€šè¿‡æœ¬æ–‡æˆ‘ä»¬å®ç°ä¸€ä¸ªè‡ªå·±çš„reactï¼Œæ¶æ„ç±»ä¼¼äºçœŸå®çš„reactæ¶æ„ï¼Œä½†æ˜¯å»æ‰äº†å¤§éƒ¨åˆ†çš„ä¼˜åŒ–é¡¹ä»¥åŠç›®å‰ä¸å¿…è¦çš„åŠŸèƒ½ã€‚</p><p>æˆ‘ä»¬ä¼šåœ¨è‡ªå·±çš„react ä¸­è¿­ä»£ 5ä¸ªç‰ˆæœ¬ å»å®ç° å¦‚ä¸‹çš„å‡½æ•°å’Œèƒ½åŠ›ã€‚</p><ol><li>V1 ç‰ˆæœ¬ï¼Œç›®æ ‡å®ç° è‡ªå·±çš„ Reactï¼Œæ›¿æ¢æ‰ çœŸæ­£çš„Reactåº“ï¼Œç¼ºç‚¹æ˜¯ï¼šå­˜åœ¨å¤§é‡èŠ‚ç‚¹æƒ…å†µä¸‹ä¼šä¸€æ¬¡æ€§æ›´æ–°å®Œã€‚</li><li>V2 ç‰ˆæœ¬ï¼Œé’ˆå¯¹ V1 ç‰ˆæœ¬ä¸­çš„ ç¼ºç‚¹è¿›è¡Œä¼˜åŒ–ï¼Œå°†ä¸€æ¬¡æ€§æ›´æ–°çš„èŠ‚ç‚¹å€Ÿç”¨ æµè§ˆå™¨çš„ <code>requestIdleCallback</code> ä»¥åŠ å¼•å…¥ <code>å¯ä¸­æ–­å’Œæ¢å¤çš„ fiberï¼ˆè™šæ‹Ÿdomç»“æ„ï¼‰ èŠ‚ç‚¹</code> è¿›è¡Œä¼˜åŒ–ï¼Œå®ç° å½“ js å¼•æ“ä¸­å­˜åœ¨é•¿æ—¶é—´è€—æ—¶çš„ä»»åŠ¡ä¸‹ï¼Œå¯¹ä»»åŠ¡è¿›è¡Œä¸­æ–­ï¼Œåœ¨æµè§ˆå™¨ç©ºé—²çš„æƒ…å†µä¸‹å»ç»§ç»­æ‰§è¡Œ Reactçš„æ›´æ–°ï¼Œç¼ºç‚¹æ˜¯ï¼šfiber ä»»åŠ¡è°ƒåº¦èŠ‚ç‚¹å’ŒèŠ‚ç‚¹æ¸²æŸ“æ˜¯åœ¨åŒä¸€é˜¶æ®µçš„ï¼Œå¯èƒ½å­˜åœ¨dom æ¸²æŸ“ä¸å®Œå…¨çš„æƒ…å†µã€‚</li><li>V3 ç‰ˆæœ¬ï¼Œå°†ä»»åŠ¡è°ƒåº¦ï¼ˆRenderï¼‰å’Œæ¸²æŸ“èŠ‚ç‚¹ï¼ˆCommitï¼‰è¿›è¡Œåˆ†ç¦»ï¼Œå®ç°æµè§ˆå™¨çš„å¤šæ¬¡ç©ºé—²æ—¶é—´å»å¤„ç† fiberèŠ‚ç‚¹ï¼Œä½†æ˜¯åªæœ‰ä¸€æ¬¡æäº¤ï¼ˆcommitï¼‰ åˆ° çœŸå®DOMçš„è¿‡ç¨‹ï¼Œè¿›è€Œè§£å†³äº† V2 ç‰ˆæœ¬ä¸­çš„æ¸²æŸ“ä¸å®Œå…¨çš„æƒ…å†µã€‚</li><li>V4 ç‰ˆæœ¬ï¼Œé€šè¿‡ä¸Šè¿°ä¸‰ä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œæˆ‘ä»¬çš„ React å·²ç»å®ç°äº† fiber èŠ‚ç‚¹çš„æš‚åœå’Œç»§ç»­ï¼Œä»¥åŠä»»åŠ¡è°ƒåº¦é˜¶æ®µå’Œæ¸²æŸ“èŠ‚ç‚¹åˆ†ç¦»çš„ èƒ½åŠ›ã€‚ä½†æ˜¯æˆªæ­¢ç›®å‰ä»…ä»…å®ç°äº† DOMèŠ‚ç‚¹çš„æ–°å¢ï¼Œæœªå®ç°æ›´æ–°å’Œåˆ é™¤ï¼ŒV4 ç‰ˆæœ¬è¦é€šè¿‡è°ƒå’Œï¼ˆreconcileChildrenï¼‰å»å®ç°æ›´æ–°å’Œåˆ é™¤ã€‚</li><li>V5 ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬å°†ä¼šå®ç° Reactçš„ å‡½æ•°ç»„ä»¶ ä»¥åŠåŸºç¡€çš„ useState hookå‡½æ•°ã€‚</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-å…ˆå®ç°ä¸ª-v10-ç‰ˆæœ¬">2. å…ˆå®ç°ä¸ª v1.0 ç‰ˆæœ¬<a href="#2-å…ˆå®ç°ä¸ª-v10-ç‰ˆæœ¬" class="hash-link" aria-label="2. å…ˆå®ç°ä¸ª v1.0 ç‰ˆæœ¬çš„ç›´æ¥é“¾æ¥" title="2. å…ˆå®ç°ä¸ª v1.0 ç‰ˆæœ¬çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-reactä¸­çš„jsxæ˜¯å¦‚ä½•è½¬å˜ä¸ºçœŸå®domçš„æˆ‘ä»¬æ¥äº²è‡ªæŠŠå®ç°ä¸€ä¸‹">2.1 Reactä¸­çš„jsxæ˜¯å¦‚ä½•è½¬å˜ä¸ºçœŸå®DOMçš„ï¼Ÿæˆ‘ä»¬æ¥äº²è‡ªæŠŠå®ç°ä¸€ä¸‹ã€‚<a href="#21-reactä¸­çš„jsxæ˜¯å¦‚ä½•è½¬å˜ä¸ºçœŸå®domçš„æˆ‘ä»¬æ¥äº²è‡ªæŠŠå®ç°ä¸€ä¸‹" class="hash-link" aria-label="2.1 Reactä¸­çš„jsxæ˜¯å¦‚ä½•è½¬å˜ä¸ºçœŸå®DOMçš„ï¼Ÿæˆ‘ä»¬æ¥äº²è‡ªæŠŠå®ç°ä¸€ä¸‹ã€‚çš„ç›´æ¥é“¾æ¥" title="2.1 Reactä¸­çš„jsxæ˜¯å¦‚ä½•è½¬å˜ä¸ºçœŸå®DOMçš„ï¼Ÿæˆ‘ä»¬æ¥äº²è‡ªæŠŠå®ç°ä¸€ä¸‹ã€‚çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æˆ‘å·²ç»æŠŠç›¸å…³çš„åŸºç¡€ä»£ç ä¸Šä¼ è‡³ ä»£ç åº“ï¼Œæ³¨æ„ åˆ†æ”¯ä¸º <code>develop</code>ã€‚</p><p>Gitee: <a href="https://gitee.com/fujunkui1996/didact/tree/develop/" target="_blank" rel="noopener noreferrer">https://gitee.com/fujunkui1996/didact/tree/develop/</a></p><p>Github: <a href="https://github.com/fu1996/didact/tree/develop" target="_blank" rel="noopener noreferrer">https://github.com/fu1996/didact/tree/develop</a></p><p>åŸºç¡€ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;react&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ReactDOM</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;react-dom&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">App</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">title</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">foo</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Hello</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag class-name" style="color:#00009f">App</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;root&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä»¥ä¸Šä»£ç ä¼šåœ¨ID ä¸º root çš„DOM èŠ‚ç‚¹ æ¸²æŸ“å‡ºä¸€ä¸ª æ–‡æœ¬ä¸º hello çš„ h1 èŠ‚ç‚¹ã€‚ React ä¼šå°† jsx ä»£ç é€šè¿‡ Babel è½¬ä¹‰ä¸ºçœŸæ­£çš„ React.createElement å¯¹è±¡ã€‚è¿™ä¸€ç‚¹é€šè¿‡åœ¨çº¿Babelå·¥å…·å³å¯æŸ¥çœ‹ã€‚<a href="https://www.babeljs.cn/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&amp;build=&amp;builtIns=false&amp;corejs=3.21&amp;spec=false&amp;loose=false&amp;code_lz=JYWwDg9gTgLgBAJQKYEMDG8BmUIjgcilQ3wG4AoUSWRYmAEQHkBZObXAo9GAWgBNcZcuTQQAdgGd4AQTBg4AXjgAKAJSKAfHADe5OPrhEYAVyhi4AHgAWARjgxgMADZIFAIkwQIbjQAkkTk4QFgD0thoUAL7CyNxMzAB0RGJ8SFDKFrLyIRoANHACaMYgSGIwCQDmSDAAoi4lZQBCAJ4AknzKhF4w-KqqFORAA&amp;debug=false&amp;forceAllTransforms=false&amp;modules=false&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=false&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=true&amp;presets=env%2Creact%2Cstage-2&amp;prettier=false&amp;targets=&amp;version=7.22.12&amp;externalPlugins=&amp;assumptions=%7B%7D" target="_blank" rel="noopener noreferrer">ç‚¹æˆ‘æŸ¥çœ‹ç¤ºä¾‹</a></p><p><img loading="lazy" alt="image-20230827162710173" src="/assets/images/image-20230827162710173-35da3468b7939eacc5331cc0b8d64d3c.png" width="2876" height="1488" class="img_ev3q"></p><p>é‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯è¦æ¢ç©¶ä¸€ä¸‹ React.createElement åšäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿæˆ‘ä»¬æ¥è¾“å‡ºä¸€ä¸‹ã€‚</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">App</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Hello&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">title</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">foo</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Hello</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">title</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">foo</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Hello</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æŸ¥çœ‹æ§åˆ¶å°ï¼š</p><p><img loading="lazy" alt="image-20230827163812820" src="/assets/images/image-20230827163812820-96480c7002c2bef636915e03124561b9.png" width="1390" height="888" class="img_ev3q"></p><p>React.createElement é€šè¿‡ä¼ å…¥çš„å‚æ•°ï¼Œåœ¨ç®€å•çš„éªŒè¯è¿‡ååˆ›å»ºäº†ä¸€ä¸ªjså¯¹è±¡å¹¶è¿”å›ï¼Œåœ¨è¿™ä¸ªjså¯¹è±¡ä¸­æˆ‘ä»¬å½“å‰å…³å¿ƒçš„é‡è¦çš„å±æ€§å¦‚ä¸‹ï¼š</p><ul><li><p>typeï¼šå½“å‰èŠ‚ç‚¹çš„ç±»å‹</p></li><li><p>propsï¼šå½“å‰èŠ‚ç‚¹çš„æ‹¥æœ‰çš„å±æ€§ä¿¡æ¯</p><p><code>type</code> å¯¹åº”ä½ æƒ³è¦åˆ›å»ºçš„ <code>dom</code> å…ƒç´ ï¼Œå°±åƒä½ ä½¿ç”¨ <code>document.createElement</code> å»åˆ›å»º <code>HTML</code> å…ƒç´ æ—¶ä¼ é€’çš„æ ‡ç­¾åå‚æ•°æ˜¯ä¸€æ ·çš„ã€‚</p></li></ul><p><code>prop</code>å±æ€§å¯¹åº”çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæŠŠ <code>jsx</code> ä¸Šé¢çš„æ‰€æœ‰å®šä¹‰çš„å±æ€§é€šè¿‡<em>é”®å€¼å¯¹</em>çš„æ–¹å¼ä¿å­˜èµ·æ¥ã€‚å…¶ä¸­è¿˜åŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼Œ<code>children</code>å±æ€§ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ <code>children</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œç»å¸¸ä¸ºå¤šä¸ªä»¥æ•°ç»„å½¢å¼ä¿å­˜çš„ <code>dom/jsx</code> å…ƒç´ ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„å…ƒç´ é›†ç»å¸¸ä»¥<code>æ ‘</code>çš„æ•°æ®ç»“æ„ä¿å­˜ã€‚</p><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™å—ä»£ç åšç®€åŒ–ï¼Œä¸éœ€è¦å‡½æ•°ç»„ä»¶Appï¼Œç›´æ¥å†™ä¸€ä¸ªè™šæ‹ŸDOMï¼š</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;h1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">children</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Hello&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆªè‡³ç›®å‰æˆ‘ä»¬å·²ç»å®ç°äº† jsx åˆ° è™šæ‹Ÿ DOM çš„è½¬æ¢ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦å®ç° <code>ReactDOM.render</code> æ¥å°†è™šæ‹Ÿ DOMèŠ‚ç‚¹è½¬æ¢ä¸º çœŸå®çš„DOMèŠ‚ç‚¹ã€‚</p><p>è¿™å°±è¦è€ƒéªŒåˆ°å„ä½çš„jsæ“ä½œDOMçš„èƒ½åŠ›äº†ã€‚</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// æ›¿æ¢ ReactDOM.render(element, container)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;title&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">title</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> text </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createTextNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nodeValue&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;h1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">title</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">children</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Hello&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> container </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;root&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;title&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">title</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> text </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createTextNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nodeValue&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå»æ‰æ‰€æœ‰ react ç›¸å…³ä»£ç çš„ä¸åˆšå¼€å§‹åŠŸèƒ½ä¸€è‡´çš„ demo åº”ç”¨ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22-å®ç°ä¸€ä¸ª-createelement-å‡½æ•°">2.2 å®ç°ä¸€ä¸ª createElement å‡½æ•°<a href="#22-å®ç°ä¸€ä¸ª-createelement-å‡½æ•°" class="hash-link" aria-label="2.2 å®ç°ä¸€ä¸ª createElement å‡½æ•°çš„ç›´æ¥é“¾æ¥" title="2.2 å®ç°ä¸€ä¸ª createElement å‡½æ•°çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†å®ç°ä¸€ä¸ªè‡ªå·±çš„ createElement å‡½æ•°ï¼Œå°† jsx å¯¹è±¡ é€šè¿‡æˆ‘ä»¬çš„æ–¹æ³•ç»™è½¬æ¢ä¸ºè™šæ‹Ÿ DOMèŠ‚ç‚¹ã€‚</p><p>ä¸Šé¢è¯´åˆ° jsx æ˜¯é€šè¿‡Babelæ’ä»¶è½¬æ¢ä¸º Reactçš„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆè¦å»çœ‹ä¸‹ç›¸å…³æ–‡æ¡£ï¼Œçœ‹æ˜¯å¦æ”¯æŒä¿®æ”¹é»˜è®¤çš„ jsx è½¬æ¢ å¯¹è±¡ã€‚</p><p><a href="https://www.babeljs.cn/docs/babel-plugin-transform-react-jsx#customizing-the-classic-runtime-import" target="_blank" rel="noopener noreferrer">https://www.babeljs.cn/docs/babel-plugin-transform-react-jsx#customizing-the-classic-runtime-import</a></p><p><img loading="lazy" alt="image-20230827170152101" src="/assets/images/image-20230827170152101-dd8bc666e7240952f5aca6859ec4694d.png" width="1510" height="1378" class="img_ev3q"></p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡é­”æ³•æ³¨é‡Šï¼Œå¯ä»¥å°†åŸæ¥ä½¿ç”¨<code>React.createElement</code> çš„ jsx è¯­æ³•æ”¹ä¸ºä½¿ç”¨ <code>Preact.h</code> å»å¤„ç†ï¼ŒåŒç†æˆ‘ä»¬å¯ä»¥æ”¹ä¸ºè‡ªå·±çš„ Reactå¯¹è±¡ã€‚</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** @jsx Didact.createElement */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">background</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c"> </span><span class="token tag special-attr attr-value value css language-css color" style="color:#e3116c">salmon</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Hello World</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h2</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">text-align</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c">right</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">from Didact</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h2</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¾“å…¥åˆ°Babelä¸­ï¼ŒéªŒè¯ä¸€ä¸‹æ­£ç¡®ä¸å¦ã€‚</p><p><img loading="lazy" alt="image-20230827170446581" src="/assets/images/image-20230827170446581-f629395194d60c958f9f25d633a3206c.png" width="2520" height="602" class="img_ev3q"></p><p><a href="https://www.babeljs.cn/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&amp;build=&amp;builtIns=false&amp;corejs=3.21&amp;spec=false&amp;loose=false&amp;code_lz=PQKhAIAECsGcA9wBECWATAhgYwC4DosAnAUwx2IFEAbYgW2IDsdwRgAoLAewdmeJvpNwAXnAAKNuHAAeNCgBu4XgE8awgEQAjbAGsA5oU4BXBmgBcSjFVrd1APklSZACwCMdgBL8qncAHVOQio0aWA3BycXACYlHFViDXJ4HABaKxQ9BjNCDOccewAzQ1pkdGwcUOcoiJlgOXkHAEoAbjYgA&amp;debug=false&amp;forceAllTransforms=false&amp;modules=false&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=false&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=true&amp;presets=env%2Creact%2Cstage-2&amp;prettier=false&amp;targets=&amp;version=7.22.12&amp;externalPlugins=&amp;assumptions=%7B%7D" target="_blank" rel="noopener noreferrer">ç‚¹æˆ‘æŸ¥çœ‹ä¸Šè¿°ä»£ç </a></p><p>ç†è®ºå¯è¡Œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å»å®ç°ä¸€ä¸ªè‡ªå·±çš„ createElement æ–¹æ³•ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è¦ç¡®è®¤ä¸€ä¸‹è¿™ä¸ªcreateElementå‡½æ•°çš„å…¥å‚éƒ½ä¼šæ˜¯ä»€ä¹ˆï¼Ÿå¿…ä¸å¯å°‘çš„æ˜¯ ä¸€ä¸ªè¡¨ç¤ºå½“å‰èŠ‚ç‚¹ç±»å‹çš„ type å­—æ®µï¼Œ ä»¥åŠå½“å‰èŠ‚ç‚¹ æ‹¥æœ‰é‚£äº›å±æ€§çš„ props å­—æ®µã€‚å…¶ä½™çš„å­—æ®µ éƒ½å¯ä»¥ä½œä¸ºå‰©ä½™å‚æ•°å½“åšchildren å­—æ®µã€‚è¿”å›å€¼æ¯«æ— ç–‘é—®æ˜¯ä¸€ä¸ª å¯ä»¥è¢«renderçš„åŒ…å«äº† type å’Œ props å±æ€§çš„è™šæ‹ŸDOMå¯¹è±¡ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">type</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> props</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter spread operator" style="color:#393A34">...</span><span class="token parameter">children</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">props</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      children</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨ children æ•°ç»„ä¸­ï¼Œè¿˜å¯ä»¥åŒ…å«ä¸€äº›åŸºæœ¬ç±»å‹çš„å€¼ï¼Œæ¯”å¦‚<em>å­—ç¬¦ä¸²</em>æˆ–è€…<em>æ•°å­—</em>ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ <code>TEXT_ELEMENT</code> æ¥æŠŠè¿™äº›ä¸æ˜¯å¯¹è±¡å­èŠ‚ç‚¹ç»™åŒ…è£…æˆå¯¹è±¡ç±»å‹ã€‚</p><p>createElement çš„ å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SPECIAL_TYPE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">TEXT_ELEMENT</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;TEXT_ELEMENT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * æŠŠå½“å‰VDomä»¥åŠVDomçš„å­èŠ‚ç‚¹è½¬ä¸ºVDom</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} type</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} props</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param  {...any} children</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">type</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> props</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter spread operator" style="color:#393A34">...</span><span class="token parameter">children</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">props</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">children</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> children</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">child</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> child </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;object&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> child </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTextElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * æ–‡æœ¬èŠ‚ç‚¹è¦åšç‰¹æ®Šå¤„ç†</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} text</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createTextElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SPECIAL_TYPE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">TEXT_ELEMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">nodeValue</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> text</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">children</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å»å®ç° Render å‡½æ•°ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23-å®ç°-render-å‡½æ•°">2.3 å®ç° render å‡½æ•°<a href="#23-å®ç°-render-å‡½æ•°" class="hash-link" aria-label="2.3 å®ç° render å‡½æ•°çš„ç›´æ¥é“¾æ¥" title="2.3 å®ç° render å‡½æ•°çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æˆ‘ä»¬ç°åœ¨å…ˆåªè€ƒè™‘å¾€ <code>document</code> ä¸Šé¢<strong>æ·»åŠ </strong>å…ƒç´ ï¼Œè€Œä¸å»è€ƒè™‘<strong>æ›´æ–°</strong>æˆ–è€…<strong>åˆ é™¤</strong>å…ƒç´ ã€‚</p><p>æƒ³è¦å®ç°ä¸€ä¸ªrender å‡½æ•°ï¼Œé¦–å…ˆæ­¤å‡½æ•°çš„å…¥å‚ä¼šæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯è™šæ‹ŸDOMèŠ‚ç‚¹ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ç”¨äºæŒ‚è½½è™šæ‹ŸDOMçš„çœŸå®çš„DOMèŠ‚ç‚¹ï¼Œ</p><p>è€ƒè™‘åˆ°è™šæ‹ŸDOMèŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ ‘ç»“æ„ï¼Œæˆ‘ä»¬è¦é€’å½’çš„å¯¹å…¶æ‰€æœ‰çš„childrenèŠ‚ç‚¹è¿›è¡Œæ·»åŠ ã€‚</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">element</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> container</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dom </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">child</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨ä¹‹å‰æˆ‘ä»¬å®šä¹‰çš„æœ‰éœ€è¦å•ç‹¬å¤„ç†çš„åŸºæœ¬ç±»å‹æ•°æ®çš„è™šæ‹ŸèŠ‚ç‚¹ï¼Œå¦‚æœå…ƒç´ çš„èŠ‚ç‚¹ä¸º <code>TEXT_ELEMENT</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦å•ç‹¬åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œä¼˜åŒ– domåˆ›å»ºé€»è¾‘ã€‚</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">element</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> container</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ ¹æ®è™šæ‹ŸDOMç±»å‹åˆ›å»ºçœŸå®DOM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dom </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SPECIAL_TYPE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">TEXT_ELEMENT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createTextNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">child</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€åæˆ‘ä»¬è¦æŠŠ è™šæ‹ŸDOM ä¸Šçš„ props å±æ€§ ç»™åŒæ­¥åˆ°çœŸå®çš„ DOMå…ƒç´ ä¸Šã€‚</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">isProperty</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;children&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">keys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isProperty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">name</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dom</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å®Œæ•´çš„ renderä»£ç å¦‚ä¸‹ï¼š</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// åªæŠŠå½“å‰è™šæ‹ŸDOMçš„propç­›é€‰å‡ºæ¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">isProperty</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;children&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * æŠŠVDomè½¬ä¸ºçœŸå®DOM</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} element</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} container</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">element</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> container</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ ¹æ®è™šæ‹ŸDOMç±»å‹åˆ›å»ºçœŸå®DOM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dom </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SPECIAL_TYPE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">TEXT_ELEMENT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createTextNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">keys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isProperty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// è™šæ‹ŸDOMçš„ props ç»‘å®šåˆ°çœŸå® DOMä¸Š</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dom</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// é€’å½’å¤„ç† è¿›è¡Œç»‘å®š</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">child</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  container</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆªæ­¢ç›®å‰æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€å•1.0ç‰ˆæœ¬ï¼Œå¯ä»¥ä»jsx åˆ° è™šæ‹ŸDOM å†åˆ°çœŸå®DOMçš„åº“ï¼Œåœ¨ä»¥ä¸‹ä»£ç åº“å¯æŸ¥çœ‹å®Œæ•´ä»£ç ã€‚</p><p>Gitee: <a href="https://gitee.com/fujunkui1996/didact/tree/v1.0/" target="_blank" rel="noopener noreferrer">https://gitee.com/fujunkui1996/didact/tree/v1.0/</a></p><p>Github: <a href="https://github.com/fu1996/didact/tree/v1.0" target="_blank" rel="noopener noreferrer">https://github.com/fu1996/didact/tree/v1.0</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-ä¼˜åŒ–10-ç‰ˆæœ¬çš„å¼Šç«¯è¿­ä»£åˆ°20">3. ä¼˜åŒ–1.0 ç‰ˆæœ¬çš„å¼Šç«¯ï¼Œè¿­ä»£åˆ°2.0<a href="#3-ä¼˜åŒ–10-ç‰ˆæœ¬çš„å¼Šç«¯è¿­ä»£åˆ°20" class="hash-link" aria-label="3. ä¼˜åŒ–1.0 ç‰ˆæœ¬çš„å¼Šç«¯ï¼Œè¿­ä»£åˆ°2.0çš„ç›´æ¥é“¾æ¥" title="3. ä¼˜åŒ–1.0 ç‰ˆæœ¬çš„å¼Šç«¯ï¼Œè¿­ä»£åˆ°2.0çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨æˆ‘ä»¬å¼€å§‹æ–°çš„é‡æ„ä¹‹å‰ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹1.0ç‰ˆæœ¬çš„ä»£ç å­˜åœ¨çš„å¯ä¼˜åŒ–ç‚¹ï¼š</p><p>å‡è®¾æˆ‘ä»¬ç›®å‰æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ•°é‡æ¯”è¾ƒå¤§çš„ element æ ‘ï¼Œå› ä¸º1.0ç‰ˆæœ¬ä¸­æˆ‘ä»¬éœ€è¦é€’å½’å»å¤„ç† element  æ ‘çš„ children å±æ€§ï¼Œä¸æ–­çš„å°†å…¶æ¸²æŸ“ä¸ºçœŸå®çš„DOMï¼Œä¸€æ—¦èŠ‚ç‚¹æ•°é‡æ¯”è¾ƒå¤§ï¼Œè¿™ä¸ª å°† element æ ‘è½¬ä¸º çœŸå® DOM çš„è¿‡ç¨‹å°±ä¼šæŒç»­å ç”¨ä¸»çº¿ç¨‹ï¼Œæ­¤è¿‡ç¨‹<code>éå¸¸è€—æ—¶ å¹¶ä¸”ä¸å¯ä¸­æ–­</code>ã€‚å¦‚æœæ­¤æ—¶æµè§ˆå™¨éœ€è¦å»åšä¸€äº›é«˜å“åº”çº§çš„æ“ä½œï¼ˆå¦‚å“åº”ç”¨æˆ·è¾“å…¥æˆ–è€…è¿è¡Œä¸€äº›åŠ¨ç”»ç‰¹æ•ˆï¼‰å°†ä¼šåœ¨æ¸²æŸ“å®Œæˆå‰äº§ç”Ÿå¡é¡¿ã€‚</p><p>åŸºäºå¦‚ä¸Šåˆ†æï¼Œæˆ‘ä»¬ç°åœ¨è¦å¯¹æ¸²æŸ“ ä»»åŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œå°†å…¶æ‹†åˆ†ä¸º<code> ä¸å¤ªè€—æ—¶ä¸”å¯ä¸­æ–­çš„å°ä»»åŠ¡å•å…ƒ</code>ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªä»»åŠ¡å•å…ƒå·¥ä½œå®Œæ¯•ä»¥å æ£€æŸ¥ä¸€ä¸‹æµè§ˆå™¨æ˜¯å¦æœ‰æ›´é‡è¦çš„å·¥ä½œï¼Œå¦‚æœæœ‰å°±æ‰“æ–­ï¼Œé€€å‡ºå½“å‰çš„æ¸²æŸ“å¾ªç¯ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-å®ç°å¾ªç¯çš„å¯æ§åˆ¶å’Œå¯ä¸­æ–­workloop">3.1 å®ç°å¾ªç¯çš„å¯æ§åˆ¶å’Œå¯ä¸­æ–­ï¼ˆworkLoopï¼‰<a href="#31-å®ç°å¾ªç¯çš„å¯æ§åˆ¶å’Œå¯ä¸­æ–­workloop" class="hash-link" aria-label="3.1 å®ç°å¾ªç¯çš„å¯æ§åˆ¶å’Œå¯ä¸­æ–­ï¼ˆworkLoopï¼‰çš„ç›´æ¥é“¾æ¥" title="3.1 å®ç°å¾ªç¯çš„å¯æ§åˆ¶å’Œå¯ä¸­æ–­ï¼ˆworkLoopï¼‰çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨æˆ‘ä»¬è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œ ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback" target="_blank" rel="noopener noreferrer">requestIdleCallback</a> è¿™ä¸ªæµè§ˆå™¨æ¥å®ç°å¾ªç¯ï¼ŒrequestIdleCallback è¿™ä¸ªå‡½æ•°å°†åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æœŸè¢«è°ƒç”¨ã€‚è¿™ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ï¼Œå¦‚åŠ¨ç”»å’Œè¾“å…¥å“åº”ã€‚</p><p><code>requestIdleCallback</code>åŒæ—¶ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª<code>deadline</code>çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥ç¡®è®¤åœ¨æµè§ˆå™¨æ¥ç®¡çº¿ç¨‹å‰æˆ‘ä»¬åˆ°åº•æœ‰å¤šå°‘æ—¶é—´ã€‚</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> nextUnitOfWork </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">workLoop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">deadline</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;äº‹ä»¶å¾ªç¯&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ˜¯å¦å¯ä»¥ç»§ç»­å·¥ä½œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> shouldYield </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextUnitOfWork </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">shouldYield</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nextUnitOfWork </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">performUnitOfWork</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextUnitOfWork</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å‰©ä½™æ—¶é—´æ˜¯å¦å°äº1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> timeRemaining </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> deadline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">timeRemaining</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;å‰©ä½™æ—¶é—´&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timeRemaining</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœæ­¤å¤„çš„æ—¶é—´ä¸è¶³ï¼Œå¯èƒ½å¯¼è‡´å¤šä¸ªèŠ‚ç‚¹æ—¶å€™çš„ performUnitOfWork å‡½æ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// åªè¿›è¡Œäº†ä¸€åŠï¼Œå°±è¢«æµè§ˆå™¨æ‰“æ–­äº†ï¼Œå¯¼è‡´ç•Œé¢ä¸Šä»…æœ‰éƒ¨åˆ†èŠ‚ç‚¹ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shouldYield </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> timeRemaining </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å¾ªç¯çš„æ ¸å¿ƒåœ¨æ­¤å¤„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">requestIdleCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">workLoop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ç±»ä¼¼äºsetTimeoutï¼Œä½†æ˜¯è§¦å‘çš„æ—¶æœº æ˜¯æµè§ˆå™¨ ç©ºé—²æ—¶å€™è¿›è¡Œè°ƒç”¨ä¸€æ¬¡ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">requestIdleCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">workLoop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>reactä¸å†ä½¿ç”¨<a href="https://github.com/facebook/react/issues/11171#issuecomment-417349573" target="_blank" rel="noopener noreferrer">requestIdleCallback</a>ï¼Œå®ƒåœ¨<a href="https://github.com/facebook/react/tree/master/packages/scheduler" target="_blank" rel="noopener noreferrer">scheduler package</a>ä¸­å®ç°äº†å’Œ<code>requestIdleCallback</code>ä¸€æ ·çš„åŠŸèƒ½ã€‚</p><p>ä¸ºäº†å®ç°ä¸Šé¢çš„å¾ªç¯ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆ <code>performUnitOfWork</code> å‡½æ•°ã€‚<code>performUnitOfWork</code> å‡½æ•°é™¤äº†æ‰§è¡Œä¸€ä¸ªå°å•å…ƒçš„å·¥ä½œå¤–ï¼Œè¿˜éœ€è¦è¿”å›ä¸‹ä¸€ä¸ªéœ€è¦è¢«æ‰§è¡Œçš„å·¥ä½œå•å…ƒã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32-å®šä¹‰å·¥ä½œå•å…ƒçš„-æ•°æ®ç»“æ„-fiberå’ŒæŸ¥æ‰¾è§„åˆ™">3.2 å®šä¹‰å·¥ä½œå•å…ƒçš„ æ•°æ®ç»“æ„ ï¼ˆfiberï¼‰å’ŒæŸ¥æ‰¾è§„åˆ™<a href="#32-å®šä¹‰å·¥ä½œå•å…ƒçš„-æ•°æ®ç»“æ„-fiberå’ŒæŸ¥æ‰¾è§„åˆ™" class="hash-link" aria-label="3.2 å®šä¹‰å·¥ä½œå•å…ƒçš„ æ•°æ®ç»“æ„ ï¼ˆfiberï¼‰å’ŒæŸ¥æ‰¾è§„åˆ™çš„ç›´æ¥é“¾æ¥" title="3.2 å®šä¹‰å·¥ä½œå•å…ƒçš„ æ•°æ®ç»“æ„ ï¼ˆfiberï¼‰å’ŒæŸ¥æ‰¾è§„åˆ™çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨å®Œæˆ <code>performUnitOfWork </code>å‡½æ•°ä¹‹å‰ï¼Œä¸ºäº†æ›´å¥½çš„å®ç°ä»»åŠ¡çš„æ§åˆ¶å’ŒèŠ‚ç‚¹çš„æŸ¥æ‰¾ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸€ä¸ªå·¥ä½œå•å…ƒå®šä¹‰åä¸º <code>fiber</code> çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä¸ª element DOMèŠ‚ç‚¹ï¼Œå¯¹åº”ä¸€ä¸ª fiber ç»“æ„ï¼Œæ¯ä¸€ä¸ª fiber ç»“æ„ å¯¹åº”äº†ä¸€ä¸ª å·¥ä½œå•å…ƒã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹è¦æ¸²æŸ“çš„ å…ƒç´ æ ‘</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">Didact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">a</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h2</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å°†å¦‚ä¸Šç»“æ„æ˜ å°„ä¸º fiber æ ‘ åï¼Œå¦‚ä¸‹ï¼š</p><p><img loading="lazy" alt="img" src="/assets/images/5f72dabf160a154a6768717d-3131035-e8f2a083c11f61987d4227ec91ed0ac2.png" width="622" height="650" class="img_ev3q"></p><p>æ¯ä¸ª fiber ä»»åŠ¡èŠ‚ç‚¹ï¼Œéƒ½æœ‰å¦‚ä¸‹å±æ€§ï¼š</p><ul><li>Child: æŒ‡å‘äº† å­çº§ fiber èŠ‚ç‚¹</li><li>parentï¼šæŒ‡å‘äº† çˆ¶çº§ fiber èŠ‚ç‚¹</li><li>siblingï¼šæŒ‡å‘äº† åŒçº§ çš„å…„å¼Ÿ fiberèŠ‚ç‚¹</li></ul><p>æ¯ä¸€ä¸ªfiberèŠ‚ç‚¹ éƒ½æœ‰æŒ‡å‘äº†<code>ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ã€å½“å‰ç›¸é‚»èŠ‚ç‚¹ä»¥åŠçˆ¶èŠ‚ç‚¹çš„é“¾æ¥</code>ã€‚fiber ç»“æ„å¦‚æ­¤è®¾è®¡çš„ä¸€ä¸ªé‡è¦çš„ç›®æ ‡æ˜¯ä¸ºäº†å®¹æ˜“çš„æ‰¾åˆ°ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒã€‚</p><p>æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹ fiberçš„æŸ¥æ‰¾è§„åˆ™ã€‚</p><ol><li><p>å½“å‰<code>fiber</code> å·¥ä½œå®Œæ¯•åï¼Œå¦‚æœå½“å‰fiberå­˜åœ¨childrenå±æ€§ï¼Œåˆ™ä¼šæŠŠå½“å‰ fiberçš„children ä¸‹çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å½“åšä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒï¼Œå°† child å±æ€§ æŒ‡å‘å®ƒã€‚</p><p>ä¾‹ï¼šåœ¨å½“å‰çš„ä¾‹å­ä¸­ï¼Œå¦‚æœåœ¨ç¬¬ä¸€ä¸ª div èŠ‚ç‚¹å®Œæˆæ›´æ–°ä»»åŠ¡åï¼Œdiv çš„ child å±æ€§ æŒ‡å‘ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ  h1ã€‚</p></li><li><p>å½“å‰ fiber èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼ˆä¸å­˜åœ¨childå±æ€§ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>sibling</code> å±æ€§ï¼ˆå…„å¼ŸèŠ‚ç‚¹ï¼‰ä½œä¸ºä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒã€‚</p><p>ä¾‹ï¼š p èŠ‚ç‚¹ ä¸å­˜åœ¨ child å±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡ <code>sibling</code> å±æ€§æ‰¾åˆ° ç›¸é‚»èŠ‚ç‚¹ <code>a</code>ä½œä¸ºä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ</p></li><li><p>å½“å‰ fiber èŠ‚ç‚¹ï¼Œä¸å­˜åœ¨ child å±æ€§ï¼Œä¹Ÿä¸å­˜åœ¨  <code>sibling</code> å±æ€§ï¼ˆå…„å¼ŸèŠ‚ç‚¹ï¼‰çš„æ—¶å€™ï¼Œå°±ä¼šå»æ‰¾ çˆ¶èŠ‚ç‚¹ çš„ å…„å¼ŸèŠ‚ç‚¹ã€‚</p><p>ä¾‹ï¼šä¸Šå›¾ä¸­çš„æœ€ä¸‹é¢çš„<code>a</code>èŠ‚ç‚¹åˆ°<code>h2</code>èŠ‚ç‚¹ã€‚</p></li><li><p>å¦‚æœ fiber èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ ä¸å­˜åœ¨ï¼Œé‚£å°±ç»§ç»­å‘ä¸Šæ‰¾ çˆ¶èŠ‚ç‚¹çš„ å…„å¼ŸèŠ‚ç‚¹ï¼Œ ç›´åˆ° æ‰¾åˆ° æ ¹èŠ‚ç‚¹ã€‚</p></li></ol><p>å½“æˆ‘ä»¬åˆ°æ ¹èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¹Ÿæ„å‘³ç€åœ¨è¿™ä¸€æ¬¡<code>render</code>æˆ‘ä»¬å®Œæˆäº†æ‰€æœ‰çš„å·¥ä½œã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†ç”¨ä»£ç å®ç°ä¸Šè¿°æŸ¥æ‰¾é€»è¾‘ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="33-å®ç°fiberèŠ‚ç‚¹çš„æŸ¥æ‰¾è§„åˆ™">3.3 å®ç°fiberèŠ‚ç‚¹çš„æŸ¥æ‰¾è§„åˆ™<a href="#33-å®ç°fiberèŠ‚ç‚¹çš„æŸ¥æ‰¾è§„åˆ™" class="hash-link" aria-label="3.3 å®ç°fiberèŠ‚ç‚¹çš„æŸ¥æ‰¾è§„åˆ™çš„ç›´æ¥é“¾æ¥" title="3.3 å®ç°fiberèŠ‚ç‚¹çš„æŸ¥æ‰¾è§„åˆ™çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸ºäº†å®Œæˆ æ•´æ£µ fiber æ ‘çš„åˆ›å»ºï¼Œæˆ‘ä»¬ é¦–å…ˆéœ€è¦ åˆ›å»º <code>root fiberï¼ˆæ ¹ fiberï¼‰ </code>ï¼Œå¹¶ä¸”èµ‹å€¼å…¶ <code>child</code> å±æ€§ å’Œ <code>sibling</code> å±æ€§ã€‚</p><p>é¦–å…ˆå°† nextUnitOfWork çš„å€¼è®¾ä¸º fiber æ ¹èŠ‚ç‚¹ã€‚</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} element VDom</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} container çœŸå®æŒ‚è½½çš„DOMèŠ‚ç‚¹</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">element</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> container</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;äº‹ä»¶å¾ªç¯çš„èµ·ç‚¹&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> container</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å³å°†å¼€å§‹å·¥ä½œçš„ åŸºç¡€å•å…ƒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nextUnitOfWork </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">dom</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> container</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">children</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">isArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿™æ ·åœ¨æµè§ˆå™¨ç©ºé—²æ—¶å€™è¿›è¡Œç¬¬ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™ï¼Œä¼šå…ˆä» æ ¹ fiber èŠ‚ç‚¹ å¼€å§‹å·¥ä½œã€‚</p><p>å°†ä¹‹å‰ å†™çš„ render å‡½æ•°çš„ä»£ç  æŠ½ç¦»ä¸º <code>createDom</code> å‡½æ•°</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// åªæŠŠå½“å‰è™šæ‹ŸDOMçš„propç­›é€‰å‡ºæ¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">isProperty</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;children&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createDom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">fiber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// æ ¹æ®è™šæ‹ŸDOMç±»å‹åˆ›å»ºçœŸå®DOM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dom </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SPECIAL_TYPE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">TEXT_ELEMENT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createTextNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">keys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isProperty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// è™šæ‹ŸDOMçš„ props ç»‘å®šåˆ°çœŸå® DOMä¸Š</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dom</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> dom</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ä¸‹æ¥ æˆ‘ä»¬å»å®ç° ä¹…è¿çš„ <code>performUnitOfWork</code> å‡½æ•°äº†ã€‚</p><ol><li><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸‹å½“å‰çš„å·¥ä½œèŠ‚ç‚¹çš„ dom å±æ€§ æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœ ä¸å­˜åœ¨ dom å±æ€§ï¼Œå°±æ ¹æ®å½“å‰èŠ‚ç‚¹çš„ç±»å‹ åˆ›å»ºå‡ºå¯¹åº”çš„ dom èŠ‚ç‚¹ã€‚</p></li><li><p>å¦‚æœå½“å‰fiberèŠ‚ç‚¹æ˜¯æœ‰çˆ¶çº§èŠ‚ç‚¹çš„ï¼Œåˆ™ å½“å‰ èŠ‚ç‚¹ åº”è¯¥ æŒ‚åœ¨ å…¶çˆ¶çº§èŠ‚ç‚¹ä¸‹ã€‚</p></li><li><p>ç„¶åæˆ‘ä»¬éœ€è¦å¾ªç¯å½“å‰ fiberèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œç»™è¿™äº›å­èŠ‚ç‚¹ æ·»åŠ ä¸Šå¯¹åº”çš„ parent ï¼Œ sibling å’Œ child å±æ€§ã€‚</p></li><li><p>å®ç° fiber çš„ æŸ¥æ‰¾è§„åˆ™ã€‚</p></li></ol><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * åœ¨æµè§ˆå™¨çš„ä¸€æ¬¡å¾ªç¯ä¸­å¤„ç†å½“å‰çš„vdomèŠ‚ç‚¹æ¸²æŸ“åˆ°ç•Œé¢ä¸Šï¼Œå¹¶è¿”å›ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param {*} nextUnitOfWork</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">performUnitOfWork</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">fiber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å½“å‰fiberèŠ‚ç‚¹ ä¸å­˜åœ¨çœŸå®DOMï¼Œç”Ÿæˆä¸€ä¸ªçœŸå®çš„DOM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dom</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createDom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœå½“å‰èŠ‚ç‚¹çš„çˆ¶çº§å­˜åœ¨ï¼Œå°±å°†å½“å‰è™šæ‹ŸDOMèŠ‚ç‚¹æŒ‚è½½åœ¨çˆ¶çº§ä¸Š</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">parent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æŠŠå†…å®¹æ¸²æŸ“åˆ°ç•Œé¢ä¸Šã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;æ¸²æŸ“èŠ‚ç‚¹&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fiber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">parent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// éå†å­èŠ‚ç‚¹ï¼Œç»§ç»­æ‰§è¡Œ children å±æ€§æ¥è‡ªäº createElement å‡½æ•°ã€‚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> elements </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å®šä¹‰å…¶çˆ¶çº§çš„å…„å¼ŸèŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> prevSibling </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å¤„ç†å­èŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> elements</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> elements</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// åˆ›å»º element å…ƒç´ å¯¹åº”çš„ fiber å·¥ä½œå•å…ƒ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> newFiber </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">parent</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> fiber</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// æŒ‡å‘å…¶çˆ¶çº§ fiber èŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">dom</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ä»£è¡¨è¿˜æ²¡åˆ›å»ºå’ŒæŒ‚è½½ DOM èŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å½“å‰æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œchild ç»‘å®šåˆ°è‡ªèº«ï¼ŒæŸ¥æ‰¾è§„åˆ™æ˜¯ å½“å‰å·¥ä½œèŠ‚ç‚¹ä¸‹çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">child</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newFiber</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// ç»‘å®šå…¶å…„å¼ŸèŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      prevSibling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sibling</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newFiber</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ–°çš„ fiberèŠ‚ç‚¹ æˆä¸ºäº† ä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prevSibling </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newFiber</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ç»§ç»­ä¸‹ä¸€ä¸ªå·¥ä½œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;å¤„ç†å®Œå­èŠ‚ç‚¹ä»¥åçš„ç»“æœä¸º&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fiber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// å­˜åœ¨å­èŠ‚ç‚¹ï¼Œè¿”å›å­èŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">child</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> fiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">child</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 1. å¦‚æœæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œå°±æŸ¥æ‰¾å…„å¼ŸèŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> nextFiber </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fiber</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextFiber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 3. å…„å¼ŸèŠ‚ç‚¹å­˜åœ¨å°±è¿”å›</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nextFiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sibling</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> nextFiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sibling</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 2. ä¸€å±‚ä¸€å±‚å‘ä¸ŠæŸ¥æ‰¾å…„å¼ŸèŠ‚ç‚¹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nextFiber </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> nextFiber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">parent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å°†jsxè¿›è¡Œæ”¹é€ æµ‹è¯•æ€§èƒ½å¦‚ä½•ï¼š</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** @jsx Didact.createElement */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> element1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">item</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">key</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#393A34">=</span><span class="token tag script language-javascript punctuation" style="color:#393A34">{</span><span class="token tag script language-javascript" style="color:#00009f">index</span><span class="token tag script language-javascript punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Hello World </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> container </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;root&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">Didact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> container</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å‘ç°æ¸²æŸ“10000ä¸ªå…ƒç´ ï¼Œä¹Ÿæ„Ÿå—ä¸åˆ°æ˜æ˜¾çš„å¡é¡¿ã€‚ç›¸å…³æ¡ˆä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><p>Gitee: <a href="https://gitee.com/fujunkui1996/didact/tree/v2.0/" target="_blank" rel="noopener noreferrer">https://gitee.com/fujunkui1996/didact/tree/v2.0/</a></p><p>Github: <a href="https://github.com/fu1996/didact/tree/v2.0" target="_blank" rel="noopener noreferrer">https://github.com/fu1996/didact/tree/v2.0</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-æ€»ç»“å›é¡¾">4. æ€»ç»“å›é¡¾<a href="#4-æ€»ç»“å›é¡¾" class="hash-link" aria-label="4. æ€»ç»“å›é¡¾çš„ç›´æ¥é“¾æ¥" title="4. æ€»ç»“å›é¡¾çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æˆ‘ä»¬å½“å‰çš„2ä¸ªç‰ˆæœ¬å·²ç»åˆæ­¥å®ç°äº†ï¼Œå°† jsx å…ƒç´ è½¬ä¸º è™šæ‹Ÿ DOMï¼Œå†é€šè¿‡ fiberèŠ‚ç‚¹å’Œ requestIdleCallback è§£å†³å¤§æ•°æ®é‡æƒ…å†µä¸‹çš„è™šæ‹Ÿ DOM è½¬ä¸ºçœŸå® DOM æ¸²æŸ“æ—¶å€™çš„å¡é¡¿çš„é—®é¢˜ã€‚</p><p>ä½†æ˜¯åœ¨æœ€åçš„ç‰ˆæœ¬ä¸­ ä»»åŠ¡è°ƒåº¦å·¥ä½œèŠ‚ç‚¹å’ŒèŠ‚ç‚¹æ¸²æŸ“æ˜¯åœ¨åŒä¸€é˜¶æ®µçš„ï¼Œå¯èƒ½å­˜åœ¨æ¸²æŸ“ä¸å®Œå…¨çš„æƒ…å†µï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­å»è§£å†³æ­¤é—®é¢˜ã€‚</p><p>æ„Ÿè°¢æ‚¨é˜…è¯»æˆ‘çš„æ–‡ç« ï¼å¦‚æœä½ å‘ç°è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæˆ‘ä¼šéå¸¸æ„Ÿæ¿€ä½ ç»™æˆ‘çš„ GitHub/Gitee é¡¹ç›®ç‚¹ä¸ªèµï¼ˆStarï¼‰ã€‚ä½ å¯ä»¥åœ¨æˆ‘çš„ GitHub/Gitee é¡µé¢ï¼ˆé™„å¸¦åœ°å€ï¼‰æ‰¾åˆ°æ›´å¤šç›¸å…³çš„é¡¹ç›®å’Œèµ„æºã€‚ä½ çš„æ”¯æŒå°†æ˜¯æˆ‘æŒç»­åˆ†äº«æœ‰ä»·å€¼å†…å®¹çš„åŠ¨åŠ›ã€‚è°¢è°¢ï¼</p><p>Gitee: <a href="https://gitee.com/fujunkui1996/didact" target="_blank" rel="noopener noreferrer">https://gitee.com/fujunkui1996/didact</a></p><p>Github: <a href="https://github.com/fu1996/didact" target="_blank" rel="noopener noreferrer">https://github.com/fu1996/didact</a></p><p>åšå®¢åœ°å€ï¼š<a href="https://fu1996.github.io/react/build-your-react-01" target="_blank" rel="noopener noreferrer">https://fu1996.github.io/react/build-your-react-01</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/react/tags/react">react</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/react/tags/è½¬è½½">è½¬è½½</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/fu1996/fu1996.github.io/tree/main/react/å»ºé€ ä½ è‡ªå·±çš„reactï¼ˆä¸Šï¼‰.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æ­¤é¡µ</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">æœ€å<!-- -->ç”± <b>ä»˜ä¿Šå¥</b> <!-- -->äº <b><time datetime="2024-03-31T15:59:41.000Z">2024å¹´3æœˆ31æ—¥</time></b> <!-- -->æ›´æ–°</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="æ–‡ä»¶é€‰é¡¹å¡"><a class="pagination-nav__link pagination-nav__link--next" href="/react/build-your-react-02"><div class="pagination-nav__sublabel">ä¸‹ä¸€é¡µ</div><div class="pagination-nav__label">å»ºé€ ä½ è‡ªå·±çš„Reactï¼ˆä¸‹ï¼‰</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#å£°æ˜" class="table-of-contents__link toc-highlight">å£°æ˜</a></li><li><a href="#1-å¤§çº²" class="table-of-contents__link toc-highlight">1. å¤§çº²</a></li><li><a href="#2-å…ˆå®ç°ä¸ª-v10-ç‰ˆæœ¬" class="table-of-contents__link toc-highlight">2. å…ˆå®ç°ä¸ª v1.0 ç‰ˆæœ¬</a><ul><li><a href="#21-reactä¸­çš„jsxæ˜¯å¦‚ä½•è½¬å˜ä¸ºçœŸå®domçš„æˆ‘ä»¬æ¥äº²è‡ªæŠŠå®ç°ä¸€ä¸‹" class="table-of-contents__link toc-highlight">2.1 Reactä¸­çš„jsxæ˜¯å¦‚ä½•è½¬å˜ä¸ºçœŸå®DOMçš„ï¼Ÿæˆ‘ä»¬æ¥äº²è‡ªæŠŠå®ç°ä¸€ä¸‹ã€‚</a></li><li><a href="#22-å®ç°ä¸€ä¸ª-createelement-å‡½æ•°" class="table-of-contents__link toc-highlight">2.2 å®ç°ä¸€ä¸ª createElement å‡½æ•°</a></li><li><a href="#23-å®ç°-render-å‡½æ•°" class="table-of-contents__link toc-highlight">2.3 å®ç° render å‡½æ•°</a></li></ul></li><li><a href="#3-ä¼˜åŒ–10-ç‰ˆæœ¬çš„å¼Šç«¯è¿­ä»£åˆ°20" class="table-of-contents__link toc-highlight">3. ä¼˜åŒ–1.0 ç‰ˆæœ¬çš„å¼Šç«¯ï¼Œè¿­ä»£åˆ°2.0</a><ul><li><a href="#31-å®ç°å¾ªç¯çš„å¯æ§åˆ¶å’Œå¯ä¸­æ–­workloop" class="table-of-contents__link toc-highlight">3.1 å®ç°å¾ªç¯çš„å¯æ§åˆ¶å’Œå¯ä¸­æ–­ï¼ˆworkLoopï¼‰</a></li><li><a href="#32-å®šä¹‰å·¥ä½œå•å…ƒçš„-æ•°æ®ç»“æ„-fiberå’ŒæŸ¥æ‰¾è§„åˆ™" class="table-of-contents__link toc-highlight">3.2 å®šä¹‰å·¥ä½œå•å…ƒçš„ æ•°æ®ç»“æ„ ï¼ˆfiberï¼‰å’ŒæŸ¥æ‰¾è§„åˆ™</a></li><li><a href="#33-å®ç°fiberèŠ‚ç‚¹çš„æŸ¥æ‰¾è§„åˆ™" class="table-of-contents__link toc-highlight">3.3 å®ç°fiberèŠ‚ç‚¹çš„æŸ¥æ‰¾è§„åˆ™</a></li></ul></li><li><a href="#4-æ€»ç»“å›é¡¾" class="table-of-contents__link toc-highlight">4. æ€»ç»“å›é¡¾</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.48e50162.js"></script>
<script src="/assets/js/main.ded34950.js"></script>
</body>
</html>