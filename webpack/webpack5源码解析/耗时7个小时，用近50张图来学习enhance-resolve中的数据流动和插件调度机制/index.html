<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-webpack docs-doc-id-webpack5æºç è§£æ/è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">03-è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶ | ä¿Šå¥</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fu1996.github.io/webpack/webpack5æºç è§£æ/è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-webpack-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-webpack-current"><meta data-rh="true" property="og:title" content="03-è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶ | ä¿Šå¥"><meta data-rh="true" name="description" content="0. é£Ÿç”¨æœ¬æ–‡çš„æ–‡æ¡£è¯´æ˜ï¼š"><meta data-rh="true" property="og:description" content="0. é£Ÿç”¨æœ¬æ–‡çš„æ–‡æ¡£è¯´æ˜ï¼š"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fu1996.github.io/webpack/webpack5æºç è§£æ/è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶"><link data-rh="true" rel="alternate" href="https://fu1996.github.io/webpack/webpack5æºç è§£æ/è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://fu1996.github.io/webpack/webpack5æºç è§£æ/è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ä¿Šå¥ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ä¿Šå¥ Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="ä¿Šå¥" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.634bf5fc.css">
<link rel="preload" href="/assets/js/runtime~main.fcd06e4a.js" as="script">
<link rel="preload" href="/assets/js/main.18619224.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="è·³åˆ°ä¸»è¦å†…å®¹"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">è·³åˆ°ä¸»è¦å†…å®¹</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">â­ï¸ å¦‚æœè¿™ä¸ªç½‘ç«™èƒ½å¸®åŠ©åˆ°ä½ ï¼Œæ¬¢è¿ç»™ä¸€ä¸ªstaræ”¯æŒä½œè€…  <a target="_blank" rel="noopener noreferrer" href="https://github.com/fu1996/fu1996.github.io">GitHub</a></div><button type="button" aria-label="å…³é—­" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="ä¸»å¯¼èˆª" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="åˆ‡æ¢å¯¼èˆªæ " aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">ä¿Šå¥</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" docid="me">æˆ‘å’Œåšå®¢ ğŸ“</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/me">å¤§å­¦å››å¹´</a></li><li><a class="dropdown__link" href="/blog">åšå®¢</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">å‰ç«¯çŸ¥è¯†åº“ ğŸ’¡</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/html-css">HTMLå’ŒCSS</a></li><li><a class="dropdown__link" href="/js">JavaScript</a></li><li><a class="dropdown__link" href="/ts">TypeScript</a></li><li><a class="dropdown__link" href="/react/build-your-react-01">React</a></li><li><a class="dropdown__link" href="/babel">Babel åŸç†</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/webpack">Webpack æºç </a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">åç«¯çŸ¥è¯†åº“ ğŸ“–</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/linux">Linux</a></li><li><a class="dropdown__link" href="/python">Python</a></li><li><a class="dropdown__link" href="/mysql">Mysql</a></li><li><a class="dropdown__link" href="/docker">Docker</a></li><li><a class="dropdown__link" href="/k8s">K8s</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">å­¦ä¹ è¯¾ä»¶ ğŸ«</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_blank" href="/fe/index.html">å‰ç«¯åŸºç¡€ï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/py/01day/01_æ“ä½œç³»ç»Ÿï¼ˆç§‘æ™®ç« èŠ‚ï¼‰.html">Python é«˜çº§ï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/flask/index.html">Flaskï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/django/index.html">Djangoï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/py-mp/index.html">å¾®ä¿¡å¼€å‘ï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/redis/index.html">Redisï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/celery/index.html">Celeryï¼ˆè€ï¼‰</a></li><li><a class="dropdown__link" target="_blank" href="/scrapy/index.html">Scrapyï¼ˆè€ï¼‰</a></li></ul></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="æœç´¢" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/fu1996/fu1996.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="å›åˆ°é¡¶éƒ¨" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><b>ä¿Šå¥</b></a><nav aria-label="æ–‡æ¡£ä¾§è¾¹æ " class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/webpack/">webpack5æºç è§£æ</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/webpack/">01-webpack æ‰“åŒ…åŸç†</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/webpack/webpack5æºç è§£æ/02-3000å­—å›¾æ–‡å¹¶èŒ‚çš„è§£æ webpack æ ¸å¿ƒåº“ enhanced-resolve å·¥ä½œæµç¨‹å’Œæ’æ‹”å¼æ’ä»¶æœºåˆ¶">02-3000å­—å›¾æ–‡å¹¶èŒ‚çš„è§£æ webpack æ ¸å¿ƒåº“ enhanced-resolve å·¥ä½œæµç¨‹å’Œæ’æ‹”å¼æ’ä»¶æœºåˆ¶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/webpack/webpack5æºç è§£æ/è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶">03-è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/webpack/webpack5æºç è§£æ/æµ…æwebpack5ä¸­Compilerä¸­é‡è¦çš„hookè°ƒç”¨è¿‡ç¨‹">04-æµ…æwebpack5ä¸­Compilerä¸­é‡è¦çš„hookè°ƒç”¨è¿‡ç¨‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/webpack/webpack5æºç è§£æ/webpack5ä¸­çš„äº‹ä»¶è°ƒåº¦ç³»ç»Ÿå’ŒNormalModuleFactaryæ ¸å¿ƒé€»è¾‘">05-webpack5ä¸­çš„äº‹ä»¶è°ƒåº¦ç³»ç»Ÿå’ŒNormalModuleFactaryæ ¸å¿ƒé€»è¾‘</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/webpack/webpack5æºç è§£æ/webpack5çš„loader-runneræºç æµ…æ">06-webpack5çš„loader-runneræºç æµ…æ</a></li></ul></li></ul></nav><button type="button" title="æ”¶èµ·ä¾§è¾¹æ " aria-label="æ”¶èµ·ä¾§è¾¹æ " class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">æœ¬é¡µæ€»è§ˆ</button></div><div class="theme-doc-markdown markdown"><header><h1>03-è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0-é£Ÿç”¨æœ¬æ–‡çš„æ–‡æ¡£è¯´æ˜">0. é£Ÿç”¨æœ¬æ–‡çš„æ–‡æ¡£è¯´æ˜ï¼š<a href="#0-é£Ÿç”¨æœ¬æ–‡çš„æ–‡æ¡£è¯´æ˜" class="hash-link" aria-label="0. é£Ÿç”¨æœ¬æ–‡çš„æ–‡æ¡£è¯´æ˜ï¼šçš„ç›´æ¥é“¾æ¥" title="0. é£Ÿç”¨æœ¬æ–‡çš„æ–‡æ¡£è¯´æ˜ï¼šçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æœ¬ç¯‡æ–‡ç«  è€—æ—¶ <code>7ä¸ªå°æ—¶</code>å·¦å³æ‰å®Œå·¥ï¼Œç¯‡å¹…æ¶‰åŠåˆ°<code>å¤§é‡çš„æºç åŠå…¶åˆ†æçš„è¿‡ç¨‹å›¾è§£å’Œæ•°æ®</code>ï¼Œé˜…è¯»å‰ï¼Œè¯·ä¿è¯è‡ªå·±æœ‰å……åˆ†çš„æ—¶é—´ï¼Œå°½æƒ…çš„å»äº«å—<code>å¸æ”¶çŸ¥è¯†è¿›å…¥è„‘å­çš„è¿‡ç¨‹</code>ã€‚</p><p>å› ä¸ºç¯‡å¹…æœ‰é™ï¼Œå¸Œæœ›ä½ æŒæ¡ä»¥ä¸‹å‰ç½®çŸ¥è¯†ï¼š</p><ol><li>å·²ç»å­¦ä¹ è¿‡ <code>enhanced-resolve å·¥ä½œæµç¨‹å’Œæ’æ‹”å¼æ’ä»¶æœºåˆ¶</code>ï¼Œ<a href="https://juejin.cn/post/7167978104881676319" target="_blank" rel="noopener noreferrer">ç‚¹è¿™é‡Œå¤ä¹ ï¼šwebpack æ ¸å¿ƒåº“ enhanced-resolve å·¥ä½œæµç¨‹å’Œæ’æ‹”å¼æ’ä»¶æœºåˆ¶</a></li><li>äº†è§£ <code>tabaple</code> æ˜¯ä¸€ä¸ª<code>è®¢é˜…å‘å¸ƒ</code>çš„è®¾è®¡æ¨¡å¼ï¼ˆçŸ¥é“å•¥æ˜¯è®¢é˜…å‘å¸ƒå³å¯ï¼‰</li><li>å¤§è‡´äº†è§£ node ä¸­çš„æ¨¡å—æŸ¥æ‰¾æœºåˆ¶ï¼Œå¦‚ï¼š</li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">â€˜</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">xxx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">jsâ€™</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;./xxx&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;xxx&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é€šè¿‡æœ¬æ–‡ä½ å°†å­¦åˆ°å¦‚ä¸‹å†…å®¹ï¼ˆæˆ–è€…å¸¦ç€å¦‚ä¸‹ç–‘é—®å»å­¦ä¹ ï¼‰ï¼š</p><ol><li><code>enhance-resolve</code>æ˜¯å¦‚ä½•åœ¨å¤æ‚çš„æ’ä»¶è°ƒç”¨ä¹‹é—´ä¼ é€’æ•°æ®çš„ï¼Ÿ</li><li><code>Resolver å’Œ ResolverFactory</code>çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</li><li><code>Resolver</code>æ˜¯å¦‚ä½•è®¾è®¡å®ç°çš„ï¼Ÿ</li><li><code>è½¯é“¾æ¥å’Œç¡¬é“¾æ¥</code>æ˜¯ä»€ä¹ˆï¼ŸåŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ</li><li>å¦‚ä½•å¼€å‘ä¸€ä¸ª<code>enhance-resolve</code>çš„æ’ä»¶åº”ç”¨åˆ° webpack ä¸­ï¼Ÿ</li><li>å¦‚ä½•å»ä¸€æ­¥æ­¥çš„ <code>debug</code> ä¸€ä¸ªå¼€æºåº“ï¼Ÿ</li></ol><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-webpack-å’Œ-enhance-resolve-çš„å…³ç³»æ˜¯ä»€ä¹ˆ">1 webpack å’Œ enhance-resolve çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ<a href="#1-webpack-å’Œ-enhance-resolve-çš„å…³ç³»æ˜¯ä»€ä¹ˆ" class="hash-link" aria-label="1 webpack å’Œ enhance-resolve çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿçš„ç›´æ¥é“¾æ¥" title="1 webpack å’Œ enhance-resolve çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>webpack ä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„æ‰“åŒ…å·¥å…·ï¼Œå…¶å¼ºå¤§çš„ä¸ä»…ä»…æ˜¯æ’ä»¶æœºåˆ¶ï¼Œè¿˜æœ‰å…¶æ ¸å¿ƒåŒ…<code>enhance-resolve</code>æ¥å®ç°æ¨¡å—çš„è·¯å¾„æŸ¥æ‰¾ã€‚åŠŸèƒ½ä¸Šæ¥è¯´å®ƒå¯ä»¥<code>å¢å¼ºWebpackçš„æ¨¡å—è§£æèƒ½åŠ›</code>ï¼Œä½¿å…¶æ›´å®¹æ˜“æ‰¾åˆ°æ‰€éœ€çš„æ¨¡å—ï¼Œä»è€Œæé«˜ Webpack çš„<code>æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§</code>ã€‚ä»é…ç½®ä¸Šæ¥è¯´å®ƒå¯ä»¥ä¸º Webpack è§£æå™¨æ·»åŠ é¢å¤–çš„æœç´¢è·¯å¾„ä»¥åŠè§£æè§„åˆ™ï¼Œè®© Webpack<code>æ›´å¥½åœ°è§£é‡Šè·¯å¾„å’Œæ–‡ä»¶</code>ï¼Œè¿›è€Œè®© webpack æ›´åŠ ä¸“å¿ƒçš„åšæ¨¡å—æ‰“åŒ…ç›¸å…³çš„äº‹æƒ…ã€‚</p><p>äº†è§£å®ŒèƒŒæ™¯å’Œéœ€æ±‚ä»¥åï¼Œå¦‚æœè®©æˆ‘ä»¬å»å®ç°ä¸€ä¸ª enhance-resolve å‘¢ï¼Ÿ</p><p>åŠŸèƒ½ç‚¹ï¼š</p><ol><li>é¦–å…ˆè§£æå™¨æ»¡è¶³æ¨¡å—æŸ¥æ‰¾ä¸­çš„æ‰€æœ‰çš„è§„åˆ™ <a href="https://nodejs.org/docs/latest-v14.x/api/modules.html#modules_all_together" target="_blank" rel="noopener noreferrer">æ¨¡å—ï¼šé€šç”¨ JS æ¨¡å— |èŠ‚ç‚¹.js v14.21.3 æ–‡æ¡£ (nodejs.org)</a></li><li>è¦å’Œ webpack ä¸€æ ·ï¼Œæœ‰å¼ºå¤§çš„<code>æ’ä»¶åŠ è½½æœºåˆ¶å’Œè‰¯å¥½çš„é…ç½®åŠŸèƒ½</code>ã€‚</li></ol><p>è‡ªå·±å¯ä»¥å¿ƒä¸­é»˜é»˜çš„æƒ³ä¸€ä¸‹å¦‚ä½•å®ç°ä¸Šè¿°åŠŸèƒ½ç‚¹å‘¢ï¼Ÿ</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-æ¥ä¸‹æ¥å°±æ ¹æ®ä¸Šè¿°åŠŸèƒ½ç‚¹é€šè¿‡ä»£ç å»äº†è§£ä¸€ä¸‹-enhance-resolve">2. æ¥ä¸‹æ¥å°±æ ¹æ®ä¸Šè¿°åŠŸèƒ½ç‚¹é€šè¿‡ä»£ç å»äº†è§£ä¸€ä¸‹ <code>enhance-resolve</code><a href="#2-æ¥ä¸‹æ¥å°±æ ¹æ®ä¸Šè¿°åŠŸèƒ½ç‚¹é€šè¿‡ä»£ç å»äº†è§£ä¸€ä¸‹-enhance-resolve" class="hash-link" aria-label="2-æ¥ä¸‹æ¥å°±æ ¹æ®ä¸Šè¿°åŠŸèƒ½ç‚¹é€šè¿‡ä»£ç å»äº†è§£ä¸€ä¸‹-enhance-resolveçš„ç›´æ¥é“¾æ¥" title="2-æ¥ä¸‹æ¥å°±æ ¹æ®ä¸Šè¿°åŠŸèƒ½ç‚¹é€šè¿‡ä»£ç å»äº†è§£ä¸€ä¸‹-enhance-resolveçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>å’±ä»¬ä¸Šå›<a href="https://juejin.cn/post/7167978104881676319" target="_blank" rel="noopener noreferrer">å¤ªå¼ºäº†ï¼Œ3000 å­—å›¾æ–‡å¹¶èŒ‚çš„è§£æ webpack æ ¸å¿ƒåº“ enhanced-resolve å·¥ä½œæµç¨‹å’Œæ’æ‹”å¼æ’ä»¶æœºåˆ¶ï¼ŒçœŸé¦™ - æ˜é‡‘ (juejin.cn)</a>è¯´åˆ°ï¼š</p><ol><li>ResolverFactory.createResolver æ ¹æ® <code>Resolver</code> ç±»åˆ›å»ºå®ä¾‹ï¼š <code>myResolve</code> (åƒäº†é…ç½®ï¼Œåå‡ºå¯¹è±¡<code>myResolve</code>)</li><li><code>myResolve ä¸Š æ³¨å†Œå¹¶è®¢é˜…</code> å¤§é‡çš„ hook ï¼ˆæªæ”¯å¼¹è¯è´®å¤‡å¥½ï¼Œä¸€åˆ»æ¿€å‘ï¼‰</li><li>è°ƒç”¨ <code>myResolver.resolve</code> æ–¹æ³•å¼€å§‹è¿›è¡Œ æ–‡ä»¶è§£æ çš„ä¸»æµç¨‹</li><li>å†…éƒ¨é€šè¿‡ <code>resolve.doResolve</code>æ–¹æ³•ï¼Œå¼€å§‹è°ƒç”¨ç¬¬ä¸€ä¸ª hook: <code>this.hooks.resolve</code></li><li>æ‰¾åˆ°ä¹‹å‰ è®¢é˜… hook çš„ pluginï¼š<code>ParsePlugin</code></li><li><code>ParsePlugin</code> è¿›è¡Œåˆæ­¥è§£æï¼Œç„¶å é€šè¿‡<code>doResolve</code> æ‰§è¡Œä¸‹ä¸€ä¸ª hook <code>parsed-resolve</code>ï¼Œå‰æœŸå‡†å¤‡å·¥ä½œç»“æŸï¼Œé“¾å¼è°ƒç”¨å¼€å§‹ï¼Œ<code>çœŸæ­£çš„è§£ææ–‡ä»¶çš„æµç¨‹</code>ä¹Ÿå¼€å§‹ã€‚</li></ol><p>ä»ä¸Šé¢çš„ç¬¬ 2 æ­¥å¼€å§‹æ•´èµ·ï¼Œç¬¬ 2 æ­¥æ³¨å†Œäº†å“ªäº› hook å‘¢ï¼Ÿæ¥ä¸‹æ¥å¼€å§‹ç…ç…</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-ç»†ç»†å›é¡¾-myresolve-ä¸Šæ³¨å†Œçš„-hooks">2.1 ç»†ç»†å›é¡¾ <code>myResolve</code> ä¸Šæ³¨å†Œçš„ hooks<a href="#21-ç»†ç»†å›é¡¾-myresolve-ä¸Šæ³¨å†Œçš„-hooks" class="hash-link" aria-label="21-ç»†ç»†å›é¡¾-myresolve-ä¸Šæ³¨å†Œçš„-hooksçš„ç›´æ¥é“¾æ¥" title="21-ç»†ç»†å›é¡¾-myresolve-ä¸Šæ³¨å†Œçš„-hooksçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä»£ç è·³è½¬åˆ° <code>lib/ResolverFactory.js</code>çš„ <code>295</code> è¡Œå·¦å³ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//// pipeline ////</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;resolve&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;internalResolve&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;newInternalResolve&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;parsedResolve&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;describedResolve&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rawResolve&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;normalResolve&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;internal&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rawModule&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;module&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;resolveAsModule&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;undescribedResolveInPackage&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;resolveInPackage&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;resolveInExistingDirectory&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;relative&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;describedRelative&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;directory&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;undescribedExistingDirectory&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;existingDirectory&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;undescribedRawFile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rawFile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;file&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;finalFile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;existingFile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;resolved&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œæ”¾å‡º <code>ensureHook</code>çš„éƒ¨åˆ†æ ¸å¿ƒä»£ç ï¼Œå…¶ä¸»è¦ä½œç”¨å°±æ˜¯åˆ›å»ºä¸€ä¸ª <code>AsyncSeriesBailHook</code> å¼‚æ­¥ä¸²è¡Œä¿é™©å‹çš„ hookï¼Œï¼ˆæ‰€è°“çš„<code>ä¿é™©</code>ä½ å¯ä»¥æƒ³è±¡æˆæµæµªæ˜Ÿçƒ 2 ä¸­çš„<code>é¥±å’Œå¼æ•‘æ´</code>ï¼Œ1 ä¸ªä»»åŠ¡æ´¾å‡ºå¤šä¸ªæ•‘æ´é˜Ÿã€è®¢é˜…å¤šä¸ª hookã€‘ï¼Œåªè¦ä¸€ä¸ªæ•‘æ´é˜ŸæˆåŠŸäº†ã€ä¸€ä¸ª hook å­˜åœ¨è¿”å›å€¼ã€‘è¿™æ¬¡æ•‘æ´å°±ç®—æˆåŠŸäº†ã€è¿™ä¸ªè®¢é˜…äº‹ä»¶å°±ç®—ç»“æŸäº†ã€‘ï¼‰</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toCamelCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hook </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">hook</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesBailHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;request&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;resolveContext&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> hook</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>PS: <code>ensureHook</code>çš„ä½œç”¨æ˜¯</p><p>å¯ä»¥çœ‹åˆ°ä½œè€…åœ¨å¤´éƒ¨ç‰¹æ„å†™äº†ä¸€ä¸ªç®€çŸ­çš„æ³¨é‡Š <code>//// pipeline ////</code>ï¼Œç¿»è¯‘è¿‡æ¥ä¹Ÿå°±æ˜¯æµæ°´çº¿ã€‚</p><p>æµæ°´çº¿æ˜¯ä¸€ç§å·¥ä¸šç”Ÿäº§æ–¹å¼ï¼Œå®ƒå°†<code>ä¸€ä¸ªå¤§å‹å·¥ç¨‹åˆ†è§£æˆè‹¥å¹²ä¸ªå°æ­¥éª¤</code>ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æœ‰<code>ä¸“é—¨çš„å·¥äººæˆ–æœºå™¨</code>æ¥å®Œæˆï¼Œä»è€Œæé«˜ç”Ÿäº§æ•ˆç‡ã€‚æµæ°´çº¿çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥<code>æé«˜ç”Ÿäº§æ•ˆç‡ï¼Œå‡å°‘ç”Ÿäº§æˆæœ¬ï¼Œæé«˜äº§å“è´¨é‡ï¼Œå¹¶ä¸”å¯ä»¥æ›´å¿«åœ°å®Œæˆå¤§å‹å·¥ç¨‹</code>ã€‚åœ¨ IT ç•Œå°±å¯ä»¥è®¤ä¸ºæ˜¯<code>æ¨¡å—é—´è§£è€¦ï¼Œæé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</code>ã€‚</p><p>åˆ°è¿™é‡Œæµæ°´çº¿æµç¨‹ç»„è£…å®Œæ¯•ã€å¯ç†è§£æˆä¸ºæ¯ä¸ªå·¥ç§åˆ†é…äº†ç›¸å…³çš„ä»»åŠ¡ã€‘ï¼Œé‚£ä¸‹ä¸€æ­¥å°±æ˜¯è¦å¼€å§‹ç»„è£…æ¯éƒ¨åˆ†æµç¨‹ç”¨åˆ°çš„<code>å·¥å…·é›†ï¼ˆpluginsï¼‰</code>ï¼Œã€ç„¶åå†ä¸ºæ¯ä¸ªå·¥ç§åˆ†é…ä¸åŒçš„å·¥å…·ã€‘ã€‚éƒ¨åˆ†æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// resolve</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolveOptions </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">source</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;resolve&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">resolveOptions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> fullySpecified </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">source</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;internal-resolve&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">resolveOptions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">fullySpecified</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unsafeCache</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">UnsafeCachePlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cachePredicate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsafeCache</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cacheWithContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">new-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">source</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ParsePlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">new-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">source</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolveOptions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;parsed-resolve&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ParsePlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">source</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolveOptions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;parsed-resolve&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// parsed-resolve</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">DescriptionFilePlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;parsed-resolve&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  descriptionFiles</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;described-resolve&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">NextPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;after-parsed-resolve&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;described-resolve&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token spread operator" style="color:#393A34">...</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"> æ­¤å¤„çœç•¥éƒ¨åˆ†æ³¨å†Œæ’ä»¶é€»è¾‘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//// RESOLVER ////</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> plugin </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> plugins</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> plugin </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;function&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plugin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸€ç›´åˆ°æœ€åæŠŠæ ¹æ®ç”¨æˆ·é…ç½®ç”Ÿæˆçš„ç›¸å…³çš„æ’ä»¶åˆ—è¡¨<code>plugins</code>ç»™æ³¨å†Œåˆ° <code>resolver</code> ä¸Šï¼Œæ•´ä¸ªçš„<code>resolver</code> çš„ hook å’Œ plugin çš„ç»‘å®šæ‰æˆåŠŸç»“æŸã€‚</p><p>æœ¬æ¬¡è°ƒè¯•ä»£ç ç»‘å®šçš„ æ€»çš„æ’ä»¶çš„æ•°é‡ä¸º <code>41ä¸ª</code>:</p><p><img loading="lazy" alt="image.png" src="/assets/images/28be00bc1e3e489f9b6a2df84e47d8e1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645890-a90cfcbcf0d1bc99960013ba24bd2637.png" width="1512" height="1080" class="img_ev3q"></p><p>å…¶ä¸­å› ä¸º<code>NextPlugin</code>æ˜¯æµç¨‹æ¨åŠ¨æ€§æ’ä»¶å’Œä¸šåŠ¡é€»è¾‘æ— å…³ï¼Œå°±è¿‡æ»¤æ‰ï¼Œè¿˜å‰©ä¸‹ <code>32ä¸ª</code>ï¼š</p><p><img loading="lazy" alt="image.png" src="/assets/images/5d78054b35794a1a9a928fa561475429~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645974-1c4113ffa0e111eecfbe3d9c2135334e.png" width="1512" height="1081" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22-å¼€å§‹è°ƒè¯•æ­£å¼æµç¨‹å§-æµæ°´çº¿æ‰“å¼€ç”µæºè·‘èµ·æ¥äº†">2.2 å¼€å§‹è°ƒè¯•æ­£å¼æµç¨‹å§ ï¼ˆæµæ°´çº¿æ‰“å¼€ç”µæºï¼Œè·‘èµ·æ¥äº†ï¼‰<a href="#22-å¼€å§‹è°ƒè¯•æ­£å¼æµç¨‹å§-æµæ°´çº¿æ‰“å¼€ç”µæºè·‘èµ·æ¥äº†" class="hash-link" aria-label="2.2 å¼€å§‹è°ƒè¯•æ­£å¼æµç¨‹å§ ï¼ˆæµæ°´çº¿æ‰“å¼€ç”µæºï¼Œè·‘èµ·æ¥äº†ï¼‰çš„ç›´æ¥é“¾æ¥" title="2.2 å¼€å§‹è°ƒè¯•æ­£å¼æµç¨‹å§ ï¼ˆæµæ°´çº¿æ‰“å¼€ç”µæºï¼Œè·‘èµ·æ¥äº†ï¼‰çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨ <code>lib/Resolver.js</code> çš„ <code>resolve</code> æ–¹æ³•ä¸­æ˜¯æŸ¥æ‰¾è·¯å¾„å¼€å§‹çš„èµ·ç‚¹ï¼Œé¦–å…ˆå°±æ˜¯æŠŠ ç”¨æˆ·ä¼ å…¥çš„ è·¯å¾„ <code>path</code> å’Œ è¦æŸ¥æ‰¾æ–‡ä»¶çš„è·¯å¾„ <code>request</code> èµ‹å€¼ç»™ obj å¯¹è±¡ ã€æ­¤ obj æ˜¯æ ¸å¿ƒå¯¹è±¡ï¼Œå°†åœ¨å„ä¸ªæ’ä»¶ä¸­æµè½¬ä¿®æ”¹ã€‘ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/e8c455445db042609db0009444067817~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646266-b073fb5af22ae229a59a295487cc51fa.png" width="1512" height="958" class="img_ev3q"></p><p>ç„¶åå°±å¼€å§‹è°ƒç”¨è‡ªèº«çš„ <code>doResolve</code> æ–¹æ³•ï¼Œæ­£å¼å¼€å§‹æµç¨‹äº†ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/e457d03fd9c6409281393651d25b2f06~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646185-5d777b2274960749eb296350ce2d7611.png" width="1512" height="945" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-ä»-resolve-hook-å¼€å§‹çš„æµç¨‹åˆ°ç»“æŸ">3. ä» <code>resolve</code> hook å¼€å§‹çš„æµç¨‹ï¼Œåˆ°ç»“æŸ<a href="#3-ä»-resolve-hook-å¼€å§‹çš„æµç¨‹åˆ°ç»“æŸ" class="hash-link" aria-label="3-ä»-resolve-hook-å¼€å§‹çš„æµç¨‹åˆ°ç»“æŸçš„ç›´æ¥é“¾æ¥" title="3-ä»-resolve-hook-å¼€å§‹çš„æµç¨‹åˆ°ç»“æŸçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æ–­ç‚¹åˆ° <code>doResolve</code>æ–¹æ³•çš„ <code>hook.callAsync</code> éƒ¨åˆ†ï¼Œçœ‹ä¸‹ç›¸å…³çš„å‚æ•°ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/5a0632c45d194eab9b3a13e322591cbe~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645802-3e13ae7d163e21da69d53bd9d87fa491.png" width="1512" height="884" class="img_ev3q"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ­¤ hook åä¸º <code>resolve</code>ï¼Œå…¥å‚æœ‰ä¸¤ä¸ªï¼š<code>Array(2)[request,resolveContext]</code>ï¼Œç»‘å®šæ­¤ hook çš„æ’ä»¶åªæœ‰ä¸€ä¸ª <code>ParsePlugin</code> çš„æ’ä»¶ï¼Œä¼ é€’ä¸‹å»çš„å‚æ•°æ˜¯ <code>request</code> å¯¹è±¡ï¼š<code>path</code>å’Œ <code>request</code>æ˜¯é‡è¦çš„æ•°æ®ã€‚</p><p>ä¸‹ä¸€æ­¥å°±å¼€å§‹è¿›å…¥ <code>ParsePlugin</code> æ’ä»¶çœ‹çœ‹å®ƒç©¶ç«Ÿåšäº†ä»€ä¹ˆã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-è§†å¯Ÿ-parsepluginå·¥ç§çš„å·¥ä½œ">3.1 è§†å¯Ÿ <code>ParsePlugin</code>å·¥ç§çš„å·¥ä½œ<a href="#31-è§†å¯Ÿ-parsepluginå·¥ç§çš„å·¥ä½œ" class="hash-link" aria-label="31-è§†å¯Ÿ-parsepluginå·¥ç§çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="31-è§†å¯Ÿ-parsepluginå·¥ç§çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><code>ParsePlugin</code> å…¶æ ¸å¿ƒ <code>apply</code> ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> resolver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tapAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ParsePlugin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> resolveContext</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// è°ƒç”¨ resolver ä¸­çš„ parse æ–¹æ³•åˆæ­¥è§£æ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> parsed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token comment" style="color:#999988;font-style:italic">/** @type {string} */</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// åˆå¹¶æˆæ–°çš„ obj å¯¹è±¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">parsed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">requestOptions</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">parsed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fragment</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">parsed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fragment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fragment</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fragment</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsed </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> resolveContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">module</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> resolveContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Parsed request is a module&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">directory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     resolveContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Parsed request is a directory&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// There is an edge-case where a request with ## can be a path or a fragment -&gt; try both</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">request</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fragment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> directory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fragment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">endsWith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> alternative </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     directory</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token literal-property property" style="color:#36acaa">request</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">request</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">directory</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">directory </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fragment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">slice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fragment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token literal-property property" style="color:#36acaa">fragment</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doResolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     alternative</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     resolveContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doResolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolveContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doResolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolveContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç»è¿‡æ–­ç‚¹å‘ç°ï¼Œ<code>obj</code> å¯¹è±¡ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ª <code>plugin</code>é€›äº†ä¸€åœˆï¼Œç„¶åæœ€ç»ˆèµ°åˆ°äº† <code>resolver.doResolve(target, obj, null, resolveContext, callback);</code> è¿™é‡Œï¼Œå¤„ç†å®Œçš„æ•°æ®å¦‚ä¸‹ï¼šã€æ€è€ƒä¸€ä¸‹åƒäº†å•¥æ•°æ®ï¼Œåå‡ºäº†å•¥æ•°æ®ï¼Ÿã€‘</p><p><img loading="lazy" alt="image.png" src="/assets/images/eae2abb59ef94f0a90b344721cd78e8a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645841-c51c1735292f57a056c325d4eb627e3f.png" width="1512" height="252" class="img_ev3q"></p><p><img loading="lazy" alt="image.png" src="/assets/images/74f7c518783b420b8ec36675ada0f8a7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645924-9bb6f500e136403783adc756f889e010.png" width="1512" height="893" class="img_ev3q"></p><p><code>ParsePlugin</code> åƒäº† objï¼Œä»¥åå¯¹å…¶è¿›è¡Œåˆæ­¥è§£æï¼Œå¢åŠ äº†å¦‚ä¸‹å±æ€§ ã€çº¢è‰²æ˜¯åƒè¿›å»çš„ï¼Œç»¿è‰²æ˜¯åå‡ºæ¥çš„ã€‘</p><p><img loading="lazy" alt="image.png" src="/assets/images/845edce1e50c4346971a61c29aa6f698~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645941-6b49a90708a746a867bb1eefbc9f44de.png" width="1512" height="625" class="img_ev3q"></p><p>ç„¶åä¸‹ä¸€ä¸ªè¦æ‰§è¡Œ hook æ˜¯<code>parsedResolve</code>ï¼Œå…¶ç»‘å®šçš„ä¸šåŠ¡æ’ä»¶æ˜¯ <code>DescriptionFilePlugin</code>ï¼Œ<code>NextPlugin</code>æ’ä»¶å±äºæµç¨‹æ’ä»¶ï¼Œå¯ä»¥å¿½ç•¥ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/3381574d6d604f93ad7f4d43e6137771~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645941-28dc90a22d867c6f3a4339a90afff563.png" width="1512" height="833" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32-è§†å¯Ÿ-descriptionfilepluginå·¥ç§çš„å·¥ä½œ">3.2 è§†å¯Ÿ <code>DescriptionFilePlugin</code>å·¥ç§çš„å·¥ä½œ<a href="#32-è§†å¯Ÿ-descriptionfilepluginå·¥ç§çš„å·¥ä½œ" class="hash-link" aria-label="32-è§†å¯Ÿ-descriptionfilepluginå·¥ç§çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="32-è§†å¯Ÿ-descriptionfilepluginå·¥ç§çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å½“å‰æµç¨‹çš„ <code>DescriptionFilePlugin</code> æ’ä»¶çš„æ ¸å¿ƒæ˜¯åœ¨ <code>DescriptionFileUtils.loadDescriptionFile</code>æ–¹æ³•é‡Œï¼Œ</p><p><img loading="lazy" alt="image.png" src="/assets/images/be67d5f80e3a46719bd71ad06ed775fd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645809-c9557c91eac93d9d6cba48f7da47a517.png" width="1512" height="817" class="img_ev3q"></p><p>å½“çœ‹åˆ° <code>[&#x27;package.json&#x27;]</code>çš„é‚£ä¸€åˆ»æ˜¯ä¸æ˜¯å¯ä»¥è”æƒ³å¹¶çŒœæµ‹åˆ°ï¼šæ­¤æ’ä»¶çš„ä½œç”¨å°±æ˜¯åœ¨å®ç°<code>æŸ¥æ‰¾å½“å‰çš„è·¯å¾„</code> æ˜¯å¦æ˜¯ä¸€ä¸ª å…·æœ‰<code>package.json</code>æ–‡ä»¶çš„æ¨¡å—ï¼Ÿç»§ç»­ debug <code>loadDescriptionFile</code>æ–¹æ³•ï¼Œ</p><p><img loading="lazy" alt="image.png" src="/assets/images/337e4baaa0eb4c9085e4d168c19ac9d9~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645872-18322180d0688ba00a7fa786dd7967b8.png" width="1512" height="1174" class="img_ev3q"></p><p>çœ‹åˆ°è¿™ä¸ªè·¯å¾„æ‹¼æ¥ï¼ŒéªŒè¯äº†çŒœæƒ³æ˜¯æ­£ç¡®çš„ï¼Œç»§ç»­ debug å‘ç°ï¼Œèµ°åˆ°äº†æ­¤æ–¹æ³•çš„ callback å‡½æ•°é‡Œï¼Œæ‰§è¡Œäº†ä¸€ä¸ª <code>cdUp</code> çš„æ–¹æ³•ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/04836c2e5c3e46f3a7e1e5d9899e480e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645852-f64a04f2a97cf1a7983f066065f2042d.png" width="1512" height="962" class="img_ev3q"></p><p>æˆ‘ä»¬ä¸å»çœ‹æ–¹æ³•å®ç°ï¼Œä»…ä»…çœ‹å˜æ›´ï¼Œå˜é‡ä»<code>directory</code>å˜æˆäº† <code>dir</code>ï¼Œæ•°æ®ä»<code>/Users/fujunkui/Desktop/github-project/enhanced-resolve/demo/test-find-file</code>å˜æˆäº†<code>/Users/fujunkui/Desktop/github-project/enhanced-resolve/demo</code>ï¼Œå§æ§½ï¼Œè¿˜çœŸæ˜¯è¿›å…¥äº†ä¸Šçº§ç›®å½•ï¼Œ<code>cdUp</code> 66666ã€‚</p><p>ä¸å‡ºæ‰€æ–™çš„è¯ï¼Œä»–ä¼šä¸€ç›´ <code>cdUp</code> çŸ¥é“è¿›å…¥åˆ°æ ¹ç›®å½•çš„,æŸ¥æ‰¾ <code>/package.json</code> ä¸ºæ­¢ ã€å›¾ä¸­ï¼Œæˆ‘æŠŠ enhance-resolve é¡¹ç›®çš„ package.json æ–‡ä»¶ç»™åˆ é™¤äº†ï¼Œä¸åˆ é™¤çš„è¯æ‰¾åˆ°è¿™ä¸€çº§å°±åœæ­¢äº†ã€‘ éƒ¨åˆ†æˆªå›¾</p><p><img loading="lazy" alt="image.png" src="/assets/images/5c6e25b9fa7e4b258eba172a0672b823~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645810-d555fcde88f29e9df4288da54a906c18.png" width="1512" height="1061" class="img_ev3q"></p><p><img loading="lazy" alt="image.png" src="/assets/images/5da9d77fe59545c5952ed3f0a1ae18c2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645898-298d552652fe35f2a08c107f0755914d.png" width="1512" height="788" class="img_ev3q"></p><p>æœ€åæ‰¾å‘€æ‰¾å‘€ï¼Œå°±æ˜¯æ‰¾ä¸åˆ°ä¸€ä¸ªç›®å½•å…·æœ‰<code>package.json</code> æ–‡ä»¶ï¼Œæ²¡åŠæ³•åªèƒ½èµ° <code>callback</code> äº†ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/ad02c2256ae046f184808f285e1dff7e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645820-8fe98388a7a1abba21bd4f439b07ed07.png" width="1512" height="1034" class="img_ev3q"></p><p>ç»“æœå°±æ˜¯è¿™ä¸ªæ’ä»¶ä¸€é¡¿ cdUp æ“ä½œï¼Œå•¥éƒ½æ²¡å˜ï¼Œæ³¨æ„æ­¤å¤„çš„ <code>callback()</code>è¿”å›å€¼ä¸ºç©ºï¼Œä»–å°±è¦è¿›å…¥æ­¤ hook çš„ä¸‹ä¸€ä¸ªæ’ä»¶äº†ï¼Œ<code>NextPlugin</code> æ­£å¼ç™»åœºã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="33-å¤–å–å°å“¥-nextplugin-æ­£å¼ç™»åœº">3.3 å¤–å–å°å“¥ <code>NextPlugin</code> æ­£å¼ç™»åœº<a href="#33-å¤–å–å°å“¥-nextplugin-æ­£å¼ç™»åœº" class="hash-link" aria-label="33-å¤–å–å°å“¥-nextplugin-æ­£å¼ç™»åœºçš„ç›´æ¥é“¾æ¥" title="33-å¤–å–å°å“¥-nextplugin-æ­£å¼ç™»åœºçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><code>NextPlugin</code> æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> resolver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tapAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;NextPlugin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> resolveContext</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doResolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolveContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç›´æ¥è°ƒç”¨ <code>resolver.doResolve</code> æŠŠä¸Šä¸€ä¸ª hook çš„ä¸¢å‡ºçš„æ•°æ®ï¼Œç»™ä¸‹ä¸€ä¸ª hook ä½¿ç”¨ï¼Œä¸åšä»»ä½•æ”¹å˜ï¼ˆåƒæäº† è¾›è‹¦å¸®å•†å®¶é€é¤çš„å¤–å–å°å“¥ï¼Œç‚¹èµï¼‰ã€‚</p><p>é‚£å°±æœ‰è¯·ä¸‹ä¸€ä½ hook é—ªäº®ç™»åœºï¼š</p><p><img loading="lazy" alt="image.png" src="/assets/images/f9a0ee89a713445eac03d5fcd2229a7c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645820-0fb6c8566e83988622aacf556b54d19a.png" width="1512" height="1130" class="img_ev3q"></p><p>å¥½å®¶ä¼™ï¼Œä¸‹ä¸€ä¸ª hook æ˜¯ <code>rawResolve</code>ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä»–çš„ç›‘å¬è€… éƒ½æœ‰è°ï¼Œæ‹‰å€’å§ï¼Œè¿˜æ˜¯ <code>NextPlugin</code> å¤–å–å°å“¥ï¼Œè¿™å°±æ˜¯å¤–å–å°å“¥ç‚¹é¥­ï¼ˆå¤–å–å°å“¥é€ç»™å¤–å–å°å“¥ï¼‰ï¼Ÿï¼Ÿï¼Ÿ</p><p>é‚£å°±ç»§ç»­å§ï¼Œçœ‹çœ‹è¿™ä¸ª <code>rawResolve</code> çš„ä¸‹ä¸€ä¸ª hook æ˜¯è°ï¼Œç›‘å¬çš„æ’ä»¶éƒ½æœ‰è°ï¼Ÿ</p><p><img loading="lazy" alt="image.png" src="/assets/images/face2dc39e144d22812446402d84a883~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645907-e37dab3b05069115c7ed763e63796739.png" width="1512" height="1143" class="img_ev3q"></p><p>ä¸‹ä¸€ä¸ª hook åå« <code>normalResolve</code>ï¼Œç«Ÿç„¶æœ‰ 3 ä¸ªæ’ä»¶ç›‘å¬äº†æ­¤ hookï¼Œé‚£ä¹ˆå¼€å§‹è¡¨æ¼”å§ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="34-è§†å¯Ÿ-hook-åä¸ºnormalresolve-ä¸‹é¢çš„ä¸‰ä¸ªå·¥ç§æ’ä»¶çš„å·¥ä½œ">3.4 è§†å¯Ÿ hook åä¸º<code>normalResolve</code> ä¸‹é¢çš„ä¸‰ä¸ªå·¥ç§ï¼ˆæ’ä»¶ï¼‰çš„å·¥ä½œ<a href="#34-è§†å¯Ÿ-hook-åä¸ºnormalresolve-ä¸‹é¢çš„ä¸‰ä¸ªå·¥ç§æ’ä»¶çš„å·¥ä½œ" class="hash-link" aria-label="34-è§†å¯Ÿ-hook-åä¸ºnormalresolve-ä¸‹é¢çš„ä¸‰ä¸ªå·¥ç§æ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="34-è§†å¯Ÿ-hook-åä¸ºnormalresolve-ä¸‹é¢çš„ä¸‰ä¸ªå·¥ç§æ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="341-ç¬¬ä¸€ä½å’Œç¬¬äºŒä½-é“ä»”éƒ½æ˜¯-conditionalplugin-ç¿»è¯‘ä¸ºä¸­æ–‡å°±æ˜¯æ¡ä»¶æ’ä»¶">3.4.1 ç¬¬ä¸€ä½å’Œç¬¬äºŒä½ é“ä»”éƒ½æ˜¯ <code>ConditionalPlugin</code> (ç¿»è¯‘ä¸ºä¸­æ–‡å°±æ˜¯ï¼šæ¡ä»¶æ’ä»¶)<a href="#341-ç¬¬ä¸€ä½å’Œç¬¬äºŒä½-é“ä»”éƒ½æ˜¯-conditionalplugin-ç¿»è¯‘ä¸ºä¸­æ–‡å°±æ˜¯æ¡ä»¶æ’ä»¶" class="hash-link" aria-label="341-ç¬¬ä¸€ä½å’Œç¬¬äºŒä½-é“ä»”éƒ½æ˜¯-conditionalplugin-ç¿»è¯‘ä¸ºä¸­æ–‡å°±æ˜¯æ¡ä»¶æ’ä»¶çš„ç›´æ¥é“¾æ¥" title="341-ç¬¬ä¸€ä½å’Œç¬¬äºŒä½-é“ä»”éƒ½æ˜¯-conditionalplugin-ç¿»è¯‘ä¸ºä¸­æ–‡å°±æ˜¯æ¡ä»¶æ’ä»¶çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>å¤§è‡´çŒœæµ‹ä¸€ä¸‹æ¡ä»¶æ’ä»¶ï¼šå°±æ˜¯æ»¡è¶³äº†å“ªäº›æ¡ä»¶æ‰ä¼šç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p><p>ä¸¤è€…çš„åŒºåˆ«åœ¨åˆå§‹åŒ–çš„ä¼ å‚é‡Œï¼š</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ConditionalPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;after-normal-resolve&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">module</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;resolve as module&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;raw-module&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ConditionalPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;after-normal-resolve&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">internal</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;resolve as internal import&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;internal&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ€»ä½“ä»£ç æ˜¯ï¼š</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ConditionalPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">source</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> test</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> message</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> allowAlternatives</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">test</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">allowAlternatives</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> allowAlternatives</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> allowAlternatives </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> keys </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">keys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resolver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tapAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ConditionalPlugin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> resolveContext</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> prop </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> keys</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doResolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     resolveContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     allowAlternatives</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">callback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Don&#x27;t allow other alternatives</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š ç¬¬ä¸€æ¬¡ æ’ä»¶çš„ callback ç»“æœæ˜¯ ç©ºã€ä¸‹å›¾ã€‘ï¼Œè¿›å…¥ ç¬¬äºŒä¸ª æ’ä»¶ï¼Œ</p><p><img loading="lazy" alt="image.png" src="/assets/images/c093fdcf6b85468085d4a70bdde72f06~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645820-da98fd0bd9f3a41e168ac883c2f19fc7.png" width="1512" height="913" class="img_ev3q"></p><p>ç¬¬äºŒä¸ªæ’ä»¶çš„ callback ç»“æœæ˜¯ ç©ºã€ä¸‹å›¾ã€‘ï¼Œ è¿›å…¥ <code>JoinRequestPlugin</code> æ’ä»¶</p><p><img loading="lazy" alt="image.png" src="/assets/images/d6648d572eba45e9b89d50bd98c78d0e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645828-6bd28f1ca80e4143d42fb6a636953a36.png" width="1512" height="1152" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="342-è§†å¯Ÿ-joinrequestplugin-æ’ä»¶çš„å·¥ä½œ">3.4.2 è§†å¯Ÿ <code>JoinRequestPlugin</code> æ’ä»¶çš„å·¥ä½œ<a href="#342-è§†å¯Ÿ-joinrequestplugin-æ’ä»¶çš„å·¥ä½œ" class="hash-link" aria-label="342-è§†å¯Ÿ-joinrequestplugin-æ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="342-è§†å¯Ÿ-joinrequestplugin-æ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>çœ‹åå­—å°±çŸ¥é“æ˜¯å¹²å•¥çš„ï¼Œä»»åŠ¡æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æŠŠ <code>path å’Œ request åˆå¹¶æˆæ–°çš„è·¯å¾„ èµ‹å€¼ç»™ path</code>ï¼ˆç»¿è‰²åœˆä¸­éƒ¨åˆ†ï¼‰ï¼Œ</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image.png" src="/assets/images/a8edfacabac542de907183fefca48129~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645848-3375808e73c6beefbe0610c03005286c.png" width="1512" height="1015" class="img_ev3q"></p><p>è¿™ä¸ª hook çš„äº‹æƒ…å®Œæˆäº†ï¼Œæœ‰è¯·ä¸‹ä¸€ä¸ª hook <code>relative</code>ï¼Œä»¥åŠå®ƒçš„ä¸¤ä½ç›‘å¬è€…ä»¬ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/dd334399fb2340879fea9eea8371451f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645833-e60992311fcde4e516a9be0140502482.png" width="1512" height="959" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="35-è§†å¯Ÿ-hook-åä¸ºrelative-ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§æ’ä»¶çš„å·¥ä½œ">3.5 è§†å¯Ÿ hook åä¸º<code>relative</code> ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§ï¼ˆæ’ä»¶ï¼‰çš„å·¥ä½œ<a href="#35-è§†å¯Ÿ-hook-åä¸ºrelative-ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§æ’ä»¶çš„å·¥ä½œ" class="hash-link" aria-label="35-è§†å¯Ÿ-hook-åä¸ºrelative-ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§æ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="35-è§†å¯Ÿ-hook-åä¸ºrelative-ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§æ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å…œå…œè½¬è½¬çš„åˆè¿›å…¥ <code>DescriptionFilePlugin</code> æ’ä»¶äº†ï¼Œä½†æ˜¯ æ­¤æ—¶çš„å‚æ•°å’Œä¹‹å‰çš„ä¸ä¸€æ ·äº†ï¼Œä½†æ˜¯å¥½åƒä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œæœ€åè¿˜æ˜¯ callback ä¸ºç©ºï¼Œç°å¤´åœŸè„¸çš„èµ°è¿›ä¸‹ä¸€ä¸ªæ’ä»¶äº†ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/dab0178d8d7c486aa2f70e180bfe72eb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646134-212ca804818bec5dcbe87b6ac37edf42.png" width="1512" height="777" class="img_ev3q"></p><p>ç»§ç»­èµ°åˆ° <code>NextPlugin</code>ï¼Œç„¶åè¢«é€åˆ° <code>describedRelative</code> çš„ hookï¼Œæ­¤ hook çš„ç›‘å¬è€…æœ‰ï¼š</p><p><img loading="lazy" alt="image.png" src="/assets/images/aad692653cd643e9a1dd9e55561a3f3d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645932-ea4998782b59a245d47b89db7b9f5d7f.png" width="1512" height="1069" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="35-è§†å¯Ÿ-hook-åä¸ºdescribedrelative-ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§æ¡ä»¶æ’ä»¶çš„å·¥ä½œ">3.5 è§†å¯Ÿ hook åä¸º<code>describedRelative</code> ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§ï¼ˆæ¡ä»¶æ’ä»¶ï¼‰çš„å·¥ä½œ<a href="#35-è§†å¯Ÿ-hook-åä¸ºdescribedrelative-ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§æ¡ä»¶æ’ä»¶çš„å·¥ä½œ" class="hash-link" aria-label="35-è§†å¯Ÿ-hook-åä¸ºdescribedrelative-ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§æ¡ä»¶æ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="35-è§†å¯Ÿ-hook-åä¸ºdescribedrelative-ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§æ¡ä»¶æ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ¡ä»¶æ’ä»¶è¦æ»¡è¶³çš„ç¬¬ä¸€ä¸ªé€»è¾‘å°±æ˜¯ï¼Œä¸æ˜¯æ–‡ä»¶å¤¹ï¼Œæ¨æµ‹æˆ‘ä»¬æ˜¯æ»¡è¶³çš„ï¼Œå¼€å§‹ debugã€‚</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ConditionalPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;described-relative&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">directory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;raw-file&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ConditionalPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;described-relative&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">fullySpecified</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;as directory&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;directory&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image.png" src="/assets/images/45f05be1a67c45cd83fdf685820259bd~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646103-4f3303fec10c629c4de9d331225992fb.png" width="1512" height="1065" class="img_ev3q"> ç¡®å®æ»¡è¶³äº†ä¸æ˜¯æ–‡ä»¶å¤¹çš„æ¡ä»¶ï¼Œæ¨è¿›åˆ°ä¸‹ä¸€ä¸ª hook <code>rawFile</code>ï¼Œå…¶ç›¸å…³çš„ç›‘å¬è€…æœ‰ 5 ä¸ªã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/58a2de7f9d0c4d92aace7ca62cbbf1a7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645977-cbc2dfdba8b201c1791ec41e4a976ec9.png" width="1512" height="866" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="36-è§†å¯Ÿ-hook-åä¸ºrawfile-ä¸‹é¢çš„å·¥ç§çš„å·¥ä½œ">3.6 è§†å¯Ÿ hook åä¸º<code>rawFile</code> ä¸‹é¢çš„å·¥ç§çš„å·¥ä½œ<a href="#36-è§†å¯Ÿ-hook-åä¸ºrawfile-ä¸‹é¢çš„å·¥ç§çš„å·¥ä½œ" class="hash-link" aria-label="36-è§†å¯Ÿ-hook-åä¸ºrawfile-ä¸‹é¢çš„å·¥ç§çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="36-è§†å¯Ÿ-hook-åä¸ºrawfile-ä¸‹é¢çš„å·¥ç§çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸æ»¡è¶³æ­¤æ’ä»¶ï¼Œèµ°è¿›ä¸‹ä¸€ä¸ªæ’ä»¶<code>TryNextPlugin</code>:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// raw-file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ConditionalPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;raw-file&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">fullySpecified</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;file&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>TryNextPlugin</code>ï¼ˆå°è¯•ä¸‹ä¸€ä¸ªæ’ä»¶ï¼‰ çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> resolver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tapAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;TryNextPlugin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> resolveContext</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doResolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resolveContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸ªäººæ„Ÿè§‰å…¶å®æ­¤å¤„çš„é€»è¾‘æ›´åº”è¯¥æ˜¯å°è¯•ä¸‹ä¸€ä¸ª<code>hook</code>ï¼Œè€Œä¸æ˜¯<code>æ’ä»¶</code>ï¼Œæ‰€ä»¥æ”¹ä¸º <code>TryNextHook</code>æ›´å¥½.ä¹‹æ‰€ä»¥è¿™ä¹ˆè¯´çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">plugins</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">TryNextPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;raw-file&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;no extension&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;file&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸Šé¢ä»£ç ç®€å•ç†è§£ä¸ºï¼Œè¢«æŸ¥æ‰¾çš„æ–‡ä»¶æ˜¯ ä¸å¸¦æ‰©å±•çš„æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥èµ°åˆ° åä¸º <code>file</code> çš„ hook é‡Œã€‚æ­¤ hook çš„ç›‘å¬æ’ä»¶æœ‰ï¼š</p><p><img loading="lazy" alt="image.png" src="/assets/images/e6798a9231bf4b9cace55940e9abe5a1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645902-2b07a6260eb0f238444fc3a48b6b659b.png" width="1512" height="1243" class="img_ev3q"></p><p>é‚£å°±ç»§ç»­èµ° <code>NextPlugin</code> æ’ä»¶çš„é€»è¾‘ï¼Œç„¶åèµ°å‘äº† <code>finalFile</code> çš„ hook ã€ä¸‹å›¾ã€‘,è¿›å…¥ <code>FileExistsPlugin</code> æ’ä»¶çš„é€»è¾‘é‡Œã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/234050712a4341c0bcb3a30ba02b6185~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646122-95f52487d1b0057955b733b7c8c55dbf.png" width="1512" height="999" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="37-è§†å¯Ÿ-hook-åä¸ºfinalfile-ä¸‹é¢çš„å·¥ç§fileexistspluginæ’ä»¶çš„å·¥ä½œ">3.7 è§†å¯Ÿ hook åä¸º<code>finalFile</code> ä¸‹é¢çš„å·¥ç§<code>FileExistsPlugin</code>æ’ä»¶çš„å·¥ä½œ<a href="#37-è§†å¯Ÿ-hook-åä¸ºfinalfile-ä¸‹é¢çš„å·¥ç§fileexistspluginæ’ä»¶çš„å·¥ä½œ" class="hash-link" aria-label="37-è§†å¯Ÿ-hook-åä¸ºfinalfile-ä¸‹é¢çš„å·¥ç§fileexistspluginæ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="37-è§†å¯Ÿ-hook-åä¸ºfinalfile-ä¸‹é¢çš„å·¥ç§fileexistspluginæ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä»£ç æ¯”è¾ƒç®€å•ï¼šè·å–æŸ¥æ‰¾è·¯å¾„ï¼Œç›´æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯æ–‡ä»¶å³å¯ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/ff1955089ff9410bb2ab56341066e4f7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645996-a89f364b497b9a6c56af04643fc9225a.png" width="1512" height="987" class="img_ev3q"></p><p>å‘ç°ä¸æ˜¯æ–‡ä»¶ï¼Œé‚£å°±æ‰§è¡Œ callback å‡½æ•°ï¼Œæ­¤æ’ä»¶çš„ callback å‡½æ•°æ˜¯<code>Resolver ä¸­çš„ hook.callAsync</code> ä¸­çš„ callback å‡½æ•°</p><p><img loading="lazy" alt="image.png" src="/assets/images/74ad2ac120bc4087ac6144b3d8426adb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645983-a63e9186a61ecafde14209ec6919f029.png" width="1512" height="736" class="img_ev3q"></p><p>ç„¶å <code>Resolver ä¸­çš„ hook.callAsync</code> ä¸­çš„ callback å‡½æ•°æ¥å—åˆ°çš„ err å’Œ result éƒ½æ˜¯ undefinedï¼Œå°±åˆèµ°äº† <code>doResolve</code> ä¸­æ¥å—çš„ callback å‡½æ•°ï¼Œé‚£å°±è¦å¼€å§‹ä»ç°åœ¨è¿™ä¸ª <code>finalFile</code> å‘å‰æ‰¾äº†ï¼ŒæŸ¥æ‰¾çš„è¿‡ç¨‹è¦å¿½ç•¥æ‰ å¤–å–å°å“¥å‹æ’ä»¶ æ¯”å¦‚<code>TryNextPlugin</code>å’Œ<code>NextPlugin</code>ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/a3dcbd1d87d24af88e1bac9bc89d4e79~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645969-a7061e875f6139c8e9ea3203f9375ba5.png" width="1512" height="944" class="img_ev3q"></p><p><code>finalFile</code> ä¸Šä¸€ä¸ªæ˜¯ <code>file</code>çš„ hook ç›‘å¬ ï¼ˆ<code>NextPlugin</code>å¯å¿½ç•¥ï¼‰ï¼Œ <code>file</code> çš„ä¸Šä¸€ä¸ªæ˜¯ <code>raw-file</code>ï¼Œè§¦å‘ <code>raw-file</code> ä¸‹çš„æ’ä»¶çš„ç›‘å¬ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŸ¥æ‰¾ç›‘å¬äº† hook ä½ <code>raw-file</code> çš„æ’ä»¶äº†ã€‚</p><p>è¿™å—çš„ä»£ç å¯èƒ½å› ä¸ºéƒ½å« callbackï¼Œå¹¶ä¸”è·³æ¥è·³å»çš„æœ‰äº›éš¾ä»¥ç†è§£ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¸‹é¢ç®€åŒ–è¿‡çš„ä»£ç ã€‚</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesBailHook</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tapable&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hook1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesBailHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;request&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;resolveContext&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hook1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hook2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesBailHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;request&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;resolveContext&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hook2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hook1Tap1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hook1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tapAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hook1Tap1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> resolveContext</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hook1Tap1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolveContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hook1Tap2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hook1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tapAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hook1Tap2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> resolveContext</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hook1Tap2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolveContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hook2Tap1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hook2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tapAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hook2Tap1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> resolveContext</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hook2Tap1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolveContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> hook2Tap2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hook2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tapAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hook2Tap2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> resolveContext</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hook2Tap2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolveContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;err&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hook1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">callAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;111&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;222&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hook1 callback&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> hook2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">callAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;333&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;455&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hook2 callback&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img loading="lazy" alt="image.png" src="/assets/images/58313fdbb1f843ca9ddebb6fd9e66fa7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646195-a2f965410352d2fe895fc1b87495c8b2.png" width="1512" height="446" class="img_ev3q"></p><p>è¿™å—çš„å†…å®¹æ˜¯å®šä¹‰äº†ä¸¤ä¸ª<code>å¼‚æ­¥çš„hook</code>,ç„¶ååœ¨<code>hook1 è°ƒç”¨ callAsync </code>çš„æ—¶å€™ï¼Œé‡Œé¢ä¼ é€’äº† <code>hook2 çš„ callAsync </code>è°ƒç”¨ï¼Œè¿™æ ·å°±ä¼šåœ¨è°ƒç”¨å®Œ <code>hook1</code> çš„è§¦å‘äº‹ä»¶ï¼Œç„¶åå»æ¥ç€è°ƒç”¨ <code>hook2</code> çš„è§¦å‘äº‹ä»¶ã€‚</p><p>è¿™æ ·æ˜¯ä¸æ˜¯å¯ä»¥ç†è§£ å¤šä¸ª hook ä¹‹å‰ä¼ é€’ callback çš„é€»è¾‘äº†ï¼Ÿ</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦æ‰¾ç›‘å¬äº† hook åä¸º <code>raw-file</code> çš„æ’ä»¶æœ‰å“ªäº›äº†ï¼Œç›´æ¥çœ‹ <code>ResolverFactory</code> æ³¨å†Œæ—¶é—´å¾—çŸ¥ ã€ä¸‹å›¾ã€‘ï¼Œæœ‰ 3 ä¸ªæ’ä»¶ç›‘å¬äº†ã€‚è€Œç°åœ¨çš„é¡ºåº åˆæ˜¯æŒ‰ç…§ç›‘å¬é¡ºåºå€’ç€æ‰§è¡Œ callback çš„ï¼Œé‚£å°±åº”è¯¥æ˜¯å…ˆæ‰§è¡Œ <code>AppendPlugin</code> æ’ä»¶äº†ï¼Œæ‰“ä¸Šæ–­ç‚¹ï¼Œè·‘ä¸€ä¸‹</p><p><img loading="lazy" alt="image.png" src="/assets/images/c1719db088cc4a72a9bc6486df9170b8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645966-35f68c892d11bf3ff795d9b628babbba.png" width="1512" height="962" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="38-å›é¦–æå»è§†å¯Ÿ-hook-åä¸ºraw-file-ä¸‹é¢çš„å·¥ç§appendpluginæ’ä»¶çš„å·¥ä½œ">3.8 å›é¦–æï¼Œå»è§†å¯Ÿ hook åä¸º<code>raw-file</code> ä¸‹é¢çš„å·¥ç§<code>AppendPlugin</code>æ’ä»¶çš„å·¥ä½œ<a href="#38-å›é¦–æå»è§†å¯Ÿ-hook-åä¸ºraw-file-ä¸‹é¢çš„å·¥ç§appendpluginæ’ä»¶çš„å·¥ä½œ" class="hash-link" aria-label="38-å›é¦–æå»è§†å¯Ÿ-hook-åä¸ºraw-file-ä¸‹é¢çš„å·¥ç§appendpluginæ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="38-å›é¦–æå»è§†å¯Ÿ-hook-åä¸ºraw-file-ä¸‹é¢çš„å·¥ç§appendpluginæ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><code>AppendPlugin</code> ä»£ç è¾ƒä¸ºç®€å•ï¼Œå°±æ˜¯æŠŠä¼ å…¥çš„ <code>this.appending</code> å’Œ <code>request.path</code> è¿›è¡Œæ‹¼æ¥ï¼Œç”Ÿæˆæ–°çš„ <code>request.path</code>ï¼Œ</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">AppendPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">source</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> appending</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">appending</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appending</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">ensureHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resolver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getHook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tapAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;AppendPlugin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> resolveContext</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">path</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">appending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token literal-property property" style="color:#36acaa">relativePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">relativePath</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">relativePath</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">appending</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doResolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     obj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">appending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     resolveContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æŸ¥æ‰¾ <code>this.appending</code> æ˜¯åœ¨å®ä¾‹åŒ–æ—¶å€™ä¼ å…¥çš„ï¼Œæ–­ç‚¹å¾—çŸ¥ã€‚è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ <code>extensions</code> é…ç½®</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> myResolver </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">ResolverFactory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createResolver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">fileSystem</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">CachedInputFileSystem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">extensions</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;.json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.js&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.ts&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="image.png" src="/assets/images/c897099fd1a24067b028c5f5dcd80966~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645848-a2e5b689d19765ab0b8d5bd4b5ec8c91.png" width="1512" height="1014" class="img_ev3q"></p><p>ç„¶åæ–­ç‚¹åˆ°æ­¤å¤„ï¼Œçœ‹åƒè¿›å»äº†å•¥ï¼Œåå‡ºæ¥äº†å•¥ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/e777c8924cf24f90bb185718b2d8f036~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646009-9d9fe8ecacdf2dc5c32d12dc41769810.png" width="1512" height="1066" class="img_ev3q"></p><p>ç„¶åä¸‹ä¸€ä¸ª hook æ˜¯ <code>file</code>ï¼Œåªæœ‰ä¸€ä¸ª <code>NextPlugin</code> æ’ä»¶ç›‘å¬äº†æ­¤ hookï¼Œç”¨æ¥æ¨è¿›æµç¨‹ã€ä¸‹å›¾ã€‘ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/a53a3f8d44b94921be3f14f2b303de0e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646023-e50771e0ea0ac0c0f40d11b347184bba.png" width="1512" height="1014" class="img_ev3q"></p><p>è€Œ <code>NextPlugin</code> æ’ä»¶æ˜¯å°†æµç¨‹ ä» <code>file</code> æ¨å‘äº† <code>final-file</code> hookï¼Œèµ°åˆ° 3.7 çš„æµç¨‹ï¼Œåˆ¤æ–­ä¸€ä¸‹å¸¦æœ‰æ­¤åç¼€çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨çš„è¯ï¼Œç»§ç»­ é‡å¤ <code>raw-file</code> hook çš„ <code>AppendPlugin</code> çš„æµç¨‹ï¼Œæ­¤æ—¶çš„å‚æ•°æ˜¯ <code>this.appending</code> æ˜¯ <code>.js</code> ã€ä¸‹å›¾ã€‘</p><p><img loading="lazy" alt="image.png" src="/assets/images/2639b27973604477af94c6baee52d1b0~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646039-10b1466aa11366bddea0de2f8b10dbb0.png" width="1512" height="882" class="img_ev3q"></p><p>ç»§ç»­ é‡å¤ä»¥ä¸Šçš„æ“ä½œï¼š <code>NextPlugin</code> æ’ä»¶æ˜¯å°†æµç¨‹ ä» <code>file</code> æ¨å‘äº† <code>final-file</code> hookï¼Œç„¶å <code>FileExistsPlugin</code> æ’ä»¶åˆ¤æ–­åˆ°ï¼Œæ­¤æ–‡ä»¶å­˜åœ¨ï¼Œæ¨è¿›æµç¨‹åˆ° <code>existingFile</code> çš„ hookï¼Œæ­¤ hook æœ‰ 2 ä¸ªæ’ä»¶ç›‘å¬ã€ä¸‹å›¾ã€‘ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/6fe6b350d91f406ca91e3eeeaf2d299d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645925-52212e94e31146e86402b49cb585a077.png" width="1512" height="1114" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="39-æ–‡ä»¶å­˜åœ¨äº†ä¸‹ä¸€æ­¥å»è§†å¯Ÿ-hook-åä¸ºexistingfile-ä¸‹é¢çš„æ’ä»¶çš„å·¥ä½œ">3.9 æ–‡ä»¶å­˜åœ¨äº†ï¼Œä¸‹ä¸€æ­¥å»è§†å¯Ÿ hook åä¸º<code>existingFile</code> ä¸‹é¢çš„æ’ä»¶çš„å·¥ä½œ<a href="#39-æ–‡ä»¶å­˜åœ¨äº†ä¸‹ä¸€æ­¥å»è§†å¯Ÿ-hook-åä¸ºexistingfile-ä¸‹é¢çš„æ’ä»¶çš„å·¥ä½œ" class="hash-link" aria-label="39-æ–‡ä»¶å­˜åœ¨äº†ä¸‹ä¸€æ­¥å»è§†å¯Ÿ-hook-åä¸ºexistingfile-ä¸‹é¢çš„æ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥" title="39-æ–‡ä»¶å­˜åœ¨äº†ä¸‹ä¸€æ­¥å»è§†å¯Ÿ-hook-åä¸ºexistingfile-ä¸‹é¢çš„æ’ä»¶çš„å·¥ä½œçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å…ˆå»æ‰§è¡Œ<code>SymlinkPlugin</code> é€šè¿‡ <code>fs.readlink</code> æ–¹æ³•åˆ¤æ–­å…¶æ˜¯å¦æ˜¯ç¬¦å·é“¾æ¥ä¸‹çš„æ–‡ä»¶ï¼Œ<a href="https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fcunjiu9486%2Farticle%2Fdetails%2F109076948" target="_blank" rel="noopener noreferrer">ç¬¦å·é“¾æ¥ symlink<!-- -->_<!-- -->ä»€ä¹ˆæ˜¯ç¬¦å·é“¾æ¥æˆ–ç¬¦å·é“¾æ¥ï¼Ÿ å¦‚ä½•ä¸º Windows å’Œ Linux åˆ›å»º Symlinkï¼Ÿ<!-- -->_<!-- -->cunjiu9486 çš„åšå®¢-CSDN åšå®¢</a>ï¼Œ</p><p>å†è¡¥å……ä¸€ç‚¹ <a href="https://juejin.cn/post/7075577743726870535" target="_blank" rel="noopener noreferrer">ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥çš„åŒºåˆ«ï¼Ÿ - æ˜é‡‘ (juejin.cn)</a></p><blockquote><p>å…³äºç¬¦å·é“¾æ¥è¿™é‡Œæœ‰ç‰¹æ®Šè¯´æ˜ï¼Œå‡è®¾ä½ æ–°å»ºäº† <code>b.js</code>ï¼Œåˆ é™¤äº†å½“å‰ç›®å½•ä¸‹çš„ <code>a.js</code>ï¼Œå½“å‰ç›®å½•æƒ…å†µå¦‚ä¸‹ï¼š</p></blockquote><p><img loading="lazy" alt="image.png" src="data:image/png;base64,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" width="756" height="230" class="img_ev3q"> å»ºç«‹ç¡¬é“¾æ¥ è¿›è¡Œæµ‹è¯•ï¼š</p><p><img loading="lazy" alt="image.png" src="/assets/images/381852c3a17040ada9a0f64f37a359df~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645966-0f1148bf2fca21af8658a74e15b7959a.png" width="1512" height="792" class="img_ev3q"></p><p>å»ºç«‹è½¯é“¾æ¥ï¼Œè¿›è¡Œæµ‹è¯•ï¼š</p><p><img loading="lazy" alt="image.png" src="/assets/images/20407af1d40e48929fa872d5d2519479~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646082-d063719349d86285a58f4efe8127de55.png" width="1512" height="893" class="img_ev3q"></p><blockquote><p>å…¶å®è½¯é“¾æ¥ï¼Œè¿˜åŒºåˆ†ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„çš„æƒ…å†µã€ä¸‹å›¾ã€‘ï¼Œæœ¬æ¬¡åªè€ƒè™‘ç›¸å¯¹è·¯å¾„ï¼Œå¤§å®¶å¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„è¿›è¡Œ debug.</p></blockquote><p><img loading="lazy" alt="image.png" src="/assets/images/e49865f114274db19025120e95b9670b~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645986-ba609013cfc0763b3f23716fc33f5ecb.png" width="1512" height="509" class="img_ev3q"></p><p>æˆ‘ä»¬è¿›è¡Œè½¯é“¾æ¥çš„ debugï¼Œæœ€åå‘ç°æŸ¥æ‰¾åˆ° b.js çš„è·¯å¾„ï¼Œé‚£ä¹ˆç»§ç»­ debugã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/beec008b6dfc407cb09a2e8cbe7800f1~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-d22e6696c35a1818c78479e713004473.png" width="1512" height="870" class="img_ev3q"></p><p>åˆ°æ­¤æ˜¯å‘ç°äº†è½¯é“¾æ¥çš„æºæ–‡ä»¶ï¼Œé‚£ä¹ˆä¸‹ä¸€æ­¥è‚¯å®šæ˜¯åˆ¤æ–­ æ­¤æºæ–‡ä»¶æ˜¯å¦æ˜¯å­˜åœ¨ï¼Œåˆèµ°åˆ° <code>existingFile</code>çš„ hook ã€ä¸‹å›¾ã€‘ï¼Œé‡å¤ 3.9 çš„æ­¥éª¤ï¼Œåˆèµ° <code>SymlinkPlugin</code> æ’ä»¶çš„é€»è¾‘ï¼ˆæ‹…å¿ƒè½¯é“¾æ¥çš„æºæ–‡ä»¶è¿˜æ˜¯è½¯é“¾æ¥ï¼‰ï¼Œ</p><p><img loading="lazy" alt="image.png" src="/assets/images/a11215d9c1064145a07ce8273d4d8bcc~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646080-44a2973ff47b0b788780110237fb6c2c.png" width="1512" height="923" class="img_ev3q"></p><p>ç»§ç»­ debug <code>SymlinkPlugin</code>ï¼Œå‘ç°èµ°åˆ°äº† <code>callback()</code> çš„æƒ…å†µã€ä¸‹å›¾ã€‘ï¼Œé‚£å°±æ˜¯è¦è¿›å…¥ä¸‹ä¸€ä¸ªç›‘å¬è€… ï¼ˆNextPluginï¼‰äº†ï¼Œ</p><p><img loading="lazy" alt="image.png" src="/assets/images/7034ad256fbc44d19ba1906188258d2a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646034-a7b4d71b1224d08939da332adffbcadf.png" width="1512" height="1071" class="img_ev3q"></p><p>åœ¨ <code>NextPlugin</code>ä¸­å‘ç°ç»ˆäºèµ°åˆ°äº†æœ€åçš„ hook <code>resolved</code>ï¼Œåªæœ‰ä¸€ä¸ªæ’ä»¶ <code>ResultPlugin</code> è¿›è¡Œç›‘å¬ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/459ae41de09142cea671eb389baca990~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645916-92d8672323aca93ed547d0d4e23ea144.png" width="1512" height="1010" class="img_ev3q"></p><p>è¿›å…¥ <code>ResultPlugin</code> æ’ä»¶å†…éƒ¨ï¼Œå…¶ä¸»è¦æ˜¯è°ƒç”¨äº† <code>result</code> çš„ hookï¼Œ</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolver</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">tapAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;ResultPlugin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">request</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> resolverContext</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">request </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resolverContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resolverContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;reporting result &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   resolver</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">callAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> resolverContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> resolverContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;function&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     resolverContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>debug ä¸€ä¸‹é‚£äº›æ’ä»¶ç›‘å¬äº†æ­¤ hookï¼Œå‘ç°æ˜¯ç©ºçš„ï¼Œç›´æ¥èµ°åˆ°è‡ªèº«çš„ callback å‡½æ•°é‡Œï¼Œ</p><p><img loading="lazy" alt="image.png" src="/assets/images/1153d36ee7654f8f977787de93796e71~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134645854-84f427673ab2aea755faa2f3245fd6a0.png" width="1512" height="916" class="img_ev3q"></p><p>ç»§ç»­ debug æ­¤ callback å‡½æ•°ï¼Œå°±ä¼šå‘ç°è¿™ä¸ª callback åœ¨ä¸€å±‚ä¸€å±‚çš„å‘ä¸Šä¼ é€’å€¼ï¼Œæ¥ç€ä¼ åˆ° <code>Resolver é‡Œçš„ resolve å‡½æ•°</code>é‡Œï¼Œ ç»è¿‡ <code>finishResolved</code> å¤„ç†è§£æä¸€æ¬¡ã€ä¸‹å›¾ã€‘ï¼Œæœ€åä¼ é€’ç»™ æˆ‘ä»¬è‡ªèº«çš„ callback å‡½æ•°é‡Œã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/f8e3d5481c854366b13785ff830d68f4~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646076-1dd40bc073c1a686a5f023a62a24082b.png" width="1512" height="774" class="img_ev3q"></p><p>debug åœåœ¨æˆ‘ä»¬è‡ªå·±ç›‘å¬çš„ callback å‡½æ•°é‡Œï¼Œè‡³æ­¤å®Œæˆæ•´ä½“æµç¨‹ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/d42742fbff234742a50fd3275e63ffee~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646115-4a8d5198f6a4002a5089d6a72ecc806c.png" width="1512" height="919" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-å®Œç»“æ’’èŠ±å›é¡¾æ€»ç»“">4 å®Œç»“æ’’èŠ±ï¼Œå›é¡¾æ€»ç»“ã€‚<a href="#4-å®Œç»“æ’’èŠ±å›é¡¾æ€»ç»“" class="hash-link" aria-label="4 å®Œç»“æ’’èŠ±ï¼Œå›é¡¾æ€»ç»“ã€‚çš„ç›´æ¥é“¾æ¥" title="4 å®Œç»“æ’’èŠ±ï¼Œå›é¡¾æ€»ç»“ã€‚çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>é€šè¿‡ä¸€æ­¥ä¸€æ­¥çš„ debugï¼Œä¼šå‘ç° enhance-resolve è¿™ä¸ªåº“ï¼ŒæŠŠ tapable ç»™ç”¨çš„å‡ºç¥å…¥åŒ–ï¼Œæ ¸å¿ƒçš„å¤„ç†é€»è¾‘éƒ½åœ¨ <code>Resolver</code> ä¸Šï¼Œè€Œ <code>ResolverFactory</code> åˆ™åƒæ˜¯ æµæ°´çº¿çš„ çº¿é•¿ï¼Œå€Ÿç”¨<code>Resolver</code> çš„èƒ½åŠ›ï¼Œå»æŒ‡å®šæµæ°´çº¿çš„æµç¨‹ï¼Œåˆ†é…æµæ°´çº¿æ¯ä¸ªæµç¨‹åº”è¯¥åä½œçš„å·¥ç§ã€‚</p><p>æ€»çš„é€»è¾‘é€šä¸‹æ¥ï¼Œä½ ä¼šå‘ç°ï¼Œæ‰€æœ‰çš„æ’ä»¶éƒ½æ˜¯åœ¨å¯¹ <code>obj å¯¹è±¡</code>åšæ•°æ®å˜æ›´ï¼Œæ¯ä¸ªæ’ä»¶éƒ½æœ‰è‡ªå·±çš„èŒè´£ï¼Œäº’ä¸å¹²æ¶‰ï¼Œäº’ä¸å½±å“ï¼Œé€šè¿‡ <code>NextPlugin</code>ï¼Œè¿™ä¸ªå¤–å–å°å“¥æ’ä»¶ï¼ŒæŠŠ æ•°æ®åœ¨å„ä¸ª hook æµç¨‹ä¹‹é—´è¿›è¡Œæµè½¬ï¼Œè¿›è€Œå»ºç«‹èµ·ä¸€å¥—é«˜æ•ˆçš„æµæ°´çº¿ç³»ç»Ÿï¼Œ<code>è€¦åˆæ€§ä½ï¼Œå®šåˆ¶åŒ–ç¨‹åº¦é«˜ï¼ŒåŠŸèƒ½å¼ºå¤§</code>ã€‚</p><p>è¿™é‡Œå°±ä¸ç”»æµç¨‹å›¾åšæ€»ç»“äº†ï¼Œå·ä¸ªæ‡’ï¼Œå› ä¸ºæ­¤æ–‡ç« è€—æ—¶ <code>7ä¸ªå°æ—¶</code>å·¦å³ ï¼ˆå•Šï¼Œæˆ‘çš„çœ¼é•œï¼‰ï¼Œä»å¤´åˆ°å°¾ debug ä¸‹æ¥ï¼Œå‘ç°æ”¶è·ä¸å°‘ï¼Œä»¥åå®Œå…¨å¯ä»¥æ¨¡ä»¿æ­¤åº“åŸºäºè‡ªå·±çš„ä¸šåŠ¡æµç¨‹ï¼Œå¼€å‘å®šåˆ¶ä¸€å¥—å±äºè‡ªå·±çš„é«˜æ•ˆå¯å®šåˆ¶åŒ–çš„å¯æ’æ‹”æ’ä»¶çš„å·¥ç¨‹ã€‚</p><p>å¸Œæœ›å¤§å®¶çœ‹å®Œæ­¤æ–‡ç« ä¼šæœ‰æ‰€æ”¶è·ï¼Œæ…¢æ…¢çš„å¼€å§‹è‡ªå·±çš„å­¦ä¹ æºç ä¹‹è·¯ã€‚å†²å§ï¼Œå…„å¼Ÿä»¬ã€‚</p><blockquote><p>å¦å¤–æ”¾å‡ºä¸€ä¸ªåŸºäºæ­¤åº“å¼€å‘çš„ä¸€ä¸ªæ ¹æ®ä¸åŒæ–‡ä»¶åç¼€è¿›è¡Œæ¡ä»¶ç¼–è¯‘çš„æ’ä»¶ï¼š<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40fu1996%2Fwebapck-resolver-mode-plugin" target="_blank" rel="noopener noreferrer">@fu1996/webapck-resolver-mode-plugin - npm (npmjs.com)</a></p></blockquote><p>å…„å¼Ÿä»¬ï¼Œåˆ«å¿˜è®°æ€è€ƒè§£ç­”ä¸€ä¸‹å¼€å¤´çš„é—®é¢˜ï¼Œå­¦æœ‰æ‰€è·ã€‚ä¸‹ä¸€ç¯‡æ–‡æ¡£ çš„æ–¹å‘æ˜¯ è§£æ webpack æºç ã€‚</p><p><img loading="lazy" alt="image.png" src="/assets/images/76f567701ad848098540ee28ac133c00~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0-20230715134646113-ac67c6d23415d81e8c4a03b2fd8fbb09.png" width="640" height="640" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>æ ‡ç­¾ï¼š</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/webpack/tags/js">js</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/webpack/tags/webpack">webpack</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/fu1996/fu1996.github.io/tree/main/webpack/webpack5æºç è§£æ/03-è€—æ—¶7ä¸ªå°æ—¶ï¼Œç”¨è¿‘50å¼ å›¾æ¥å­¦ä¹ enhance-resolveä¸­çš„æ•°æ®æµåŠ¨å’Œæ’ä»¶è°ƒåº¦æœºåˆ¶.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æ­¤é¡µ</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">æœ€å<!-- -->ç”± <b>fjk</b> <!-- -->äº <b><time datetime="2023-10-05T06:22:39.000Z">2023å¹´10æœˆ5æ—¥</time></b> <!-- -->æ›´æ–°</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="æ–‡ä»¶é€‰é¡¹å¡"><a class="pagination-nav__link pagination-nav__link--prev" href="/webpack/webpack5æºç è§£æ/02-3000å­—å›¾æ–‡å¹¶èŒ‚çš„è§£æ webpack æ ¸å¿ƒåº“ enhanced-resolve å·¥ä½œæµç¨‹å’Œæ’æ‹”å¼æ’ä»¶æœºåˆ¶"><div class="pagination-nav__sublabel">ä¸Šä¸€é¡µ</div><div class="pagination-nav__label">02-3000å­—å›¾æ–‡å¹¶èŒ‚çš„è§£æ webpack æ ¸å¿ƒåº“ enhanced-resolve å·¥ä½œæµç¨‹å’Œæ’æ‹”å¼æ’ä»¶æœºåˆ¶</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/webpack/webpack5æºç è§£æ/æµ…æwebpack5ä¸­Compilerä¸­é‡è¦çš„hookè°ƒç”¨è¿‡ç¨‹"><div class="pagination-nav__sublabel">ä¸‹ä¸€é¡µ</div><div class="pagination-nav__label">04-æµ…æwebpack5ä¸­Compilerä¸­é‡è¦çš„hookè°ƒç”¨è¿‡ç¨‹</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#0-é£Ÿç”¨æœ¬æ–‡çš„æ–‡æ¡£è¯´æ˜" class="table-of-contents__link toc-highlight">0. é£Ÿç”¨æœ¬æ–‡çš„æ–‡æ¡£è¯´æ˜ï¼š</a></li><li><a href="#1-webpack-å’Œ-enhance-resolve-çš„å…³ç³»æ˜¯ä»€ä¹ˆ" class="table-of-contents__link toc-highlight">1 webpack å’Œ enhance-resolve çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href="#2-æ¥ä¸‹æ¥å°±æ ¹æ®ä¸Šè¿°åŠŸèƒ½ç‚¹é€šè¿‡ä»£ç å»äº†è§£ä¸€ä¸‹-enhance-resolve" class="table-of-contents__link toc-highlight">2. æ¥ä¸‹æ¥å°±æ ¹æ®ä¸Šè¿°åŠŸèƒ½ç‚¹é€šè¿‡ä»£ç å»äº†è§£ä¸€ä¸‹ <code>enhance-resolve</code></a><ul><li><a href="#21-ç»†ç»†å›é¡¾-myresolve-ä¸Šæ³¨å†Œçš„-hooks" class="table-of-contents__link toc-highlight">2.1 ç»†ç»†å›é¡¾ <code>myResolve</code> ä¸Šæ³¨å†Œçš„ hooks</a></li><li><a href="#22-å¼€å§‹è°ƒè¯•æ­£å¼æµç¨‹å§-æµæ°´çº¿æ‰“å¼€ç”µæºè·‘èµ·æ¥äº†" class="table-of-contents__link toc-highlight">2.2 å¼€å§‹è°ƒè¯•æ­£å¼æµç¨‹å§ ï¼ˆæµæ°´çº¿æ‰“å¼€ç”µæºï¼Œè·‘èµ·æ¥äº†ï¼‰</a></li></ul></li><li><a href="#3-ä»-resolve-hook-å¼€å§‹çš„æµç¨‹åˆ°ç»“æŸ" class="table-of-contents__link toc-highlight">3. ä» <code>resolve</code> hook å¼€å§‹çš„æµç¨‹ï¼Œåˆ°ç»“æŸ</a><ul><li><a href="#31-è§†å¯Ÿ-parsepluginå·¥ç§çš„å·¥ä½œ" class="table-of-contents__link toc-highlight">3.1 è§†å¯Ÿ <code>ParsePlugin</code>å·¥ç§çš„å·¥ä½œ</a></li><li><a href="#32-è§†å¯Ÿ-descriptionfilepluginå·¥ç§çš„å·¥ä½œ" class="table-of-contents__link toc-highlight">3.2 è§†å¯Ÿ <code>DescriptionFilePlugin</code>å·¥ç§çš„å·¥ä½œ</a></li><li><a href="#33-å¤–å–å°å“¥-nextplugin-æ­£å¼ç™»åœº" class="table-of-contents__link toc-highlight">3.3 å¤–å–å°å“¥ <code>NextPlugin</code> æ­£å¼ç™»åœº</a></li><li><a href="#34-è§†å¯Ÿ-hook-åä¸ºnormalresolve-ä¸‹é¢çš„ä¸‰ä¸ªå·¥ç§æ’ä»¶çš„å·¥ä½œ" class="table-of-contents__link toc-highlight">3.4 è§†å¯Ÿ hook åä¸º<code>normalResolve</code> ä¸‹é¢çš„ä¸‰ä¸ªå·¥ç§ï¼ˆæ’ä»¶ï¼‰çš„å·¥ä½œ</a></li><li><a href="#35-è§†å¯Ÿ-hook-åä¸ºrelative-ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§æ’ä»¶çš„å·¥ä½œ" class="table-of-contents__link toc-highlight">3.5 è§†å¯Ÿ hook åä¸º<code>relative</code> ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§ï¼ˆæ’ä»¶ï¼‰çš„å·¥ä½œ</a></li><li><a href="#35-è§†å¯Ÿ-hook-åä¸ºdescribedrelative-ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§æ¡ä»¶æ’ä»¶çš„å·¥ä½œ" class="table-of-contents__link toc-highlight">3.5 è§†å¯Ÿ hook åä¸º<code>describedRelative</code> ä¸‹é¢çš„ä¸¤ä¸ªå·¥ç§ï¼ˆæ¡ä»¶æ’ä»¶ï¼‰çš„å·¥ä½œ</a></li><li><a href="#36-è§†å¯Ÿ-hook-åä¸ºrawfile-ä¸‹é¢çš„å·¥ç§çš„å·¥ä½œ" class="table-of-contents__link toc-highlight">3.6 è§†å¯Ÿ hook åä¸º<code>rawFile</code> ä¸‹é¢çš„å·¥ç§çš„å·¥ä½œ</a></li><li><a href="#37-è§†å¯Ÿ-hook-åä¸ºfinalfile-ä¸‹é¢çš„å·¥ç§fileexistspluginæ’ä»¶çš„å·¥ä½œ" class="table-of-contents__link toc-highlight">3.7 è§†å¯Ÿ hook åä¸º<code>finalFile</code> ä¸‹é¢çš„å·¥ç§<code>FileExistsPlugin</code>æ’ä»¶çš„å·¥ä½œ</a></li><li><a href="#38-å›é¦–æå»è§†å¯Ÿ-hook-åä¸ºraw-file-ä¸‹é¢çš„å·¥ç§appendpluginæ’ä»¶çš„å·¥ä½œ" class="table-of-contents__link toc-highlight">3.8 å›é¦–æï¼Œå»è§†å¯Ÿ hook åä¸º<code>raw-file</code> ä¸‹é¢çš„å·¥ç§<code>AppendPlugin</code>æ’ä»¶çš„å·¥ä½œ</a></li><li><a href="#39-æ–‡ä»¶å­˜åœ¨äº†ä¸‹ä¸€æ­¥å»è§†å¯Ÿ-hook-åä¸ºexistingfile-ä¸‹é¢çš„æ’ä»¶çš„å·¥ä½œ" class="table-of-contents__link toc-highlight">3.9 æ–‡ä»¶å­˜åœ¨äº†ï¼Œä¸‹ä¸€æ­¥å»è§†å¯Ÿ hook åä¸º<code>existingFile</code> ä¸‹é¢çš„æ’ä»¶çš„å·¥ä½œ</a></li></ul></li><li><a href="#4-å®Œç»“æ’’èŠ±å›é¡¾æ€»ç»“" class="table-of-contents__link toc-highlight">4 å®Œç»“æ’’èŠ±ï¼Œå›é¡¾æ€»ç»“ã€‚</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.fcd06e4a.js"></script>
<script src="/assets/js/main.18619224.js"></script>
</body>
</html>